<!DOCTYPE html>
<html lang="de" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenClaw Dashboard Pro v2.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-500: #3b82f6;
            --primary-600: #2563eb;
            --primary-700: #1d4ed8;
            --secondary-500: #8b5cf6;
            --success-500: #22c55e;
            --warning-500: #f59e0b;
            --error-500: #ef4444;
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #94a3b8;
            --border-color: #e2e8f0;
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }
        
        /* Dark Mode Variables */
        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border-color: #334155;
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.5);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 0 32px;
            height: 72px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
        }
        
        .brand-text h1 {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .brand-text span {
            font-size: 12px;
            color: var(--text-tertiary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 18px;
            background: linear-gradient(135deg, #f0fdf4 0%, #eff6ff 100%);
            border: 1px solid #bbf7d0;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            color: #15803d;
        }
        
        .status-indicator.offline {
            background: linear-gradient(135deg, #fef2f2 0%, #ffedd5 100%);
            border-color: #fecaca;
            color: #dc2626;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #22c55e;
            box-shadow: 0 0 0 4px #dcfce7;
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .status-indicator.offline .status-dot {
            background: #ef4444;
            box-shadow: 0 0 0 4px #fee2e2;
            animation: none;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .header-btn {
            width: 44px;
            height: 44px;
            border: none;
            background: var(--bg-tertiary);
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.2s;
            position: relative;
        }
        
        .header-btn:hover {
            background: #dbeafe;
            color: #2563eb;
            transform: translateY(-2px);
        }
        
        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 20px;
            height: 20px;
            background: #ef4444;
            color: white;
            font-size: 11px;
            font-weight: 700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--bg-secondary);
        }
        
        .layout {
            display: flex;
            min-height: calc(100vh - 72px);
        }
        
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: calc(100vh - 72px);
            overflow-y: auto;
            z-index: 100;
        }
        
        .nav-section {
            padding: 24px 16px;
        }
        
        .nav-section-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-tertiary);
            padding: 0 16px 12px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 12px 16px;
            margin: 4px 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 14px;
            position: relative;
        }
        
        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #eff6ff 0%, rgba(139, 92, 246, 0.1) 100%);
            color: #1d4ed8;
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 0 3px 3px 0;
        }
        
        .nav-item i {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }
        
        .nav-badge {
            margin-left: auto;
            padding: 4px 10px;
            background: #3b82f6;
            color: white;
            font-size: 11px;
            font-weight: 700;
            border-radius: 20px;
        }
        
        .sidebar-footer {
            margin-top: auto;
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .user-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .user-card:hover {
            background: #e2e8f0;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .user-role {
            font-size: 12px;
            color: var(--text-tertiary);
        }
        
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 32px;
            min-height: calc(100vh - 72px);
        }
        
        .page-header {
            margin-bottom: 32px;
        }
        
        .page-header h2 {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .page-header p {
            color: var(--text-secondary);
            font-size: 16px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-bottom: 32px;
        }
        
        @media (max-width: 1400px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: #bfdbfe;
        }
        
        .stat-card:hover::before {
            opacity: 1;
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .stat-icon.blue {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #2563eb;
        }
        
        .stat-icon.purple {
            background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
            color: #7c3aed;
        }
        
        .stat-icon.green {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #16a34a;
        }
        
        .stat-icon.orange {
            background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%);
            color: #ea580c;
        }
        
        .stat-trend {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .stat-trend.up {
            background: #f0fdf4;
            color: #15803d;
        }
        
        .stat-trend.down {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--text-tertiary);
            font-weight: 500;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }
        
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding-bottom: 70px;
            }
            
            .layout {
                flex-direction: column !important;
            }
            
            .sidebar {
                width: 100% !important;
                height: auto !important;
                position: fixed !important;
                bottom: 0 !important;
                left: 0 !important;
                top: auto !important;
                right: 0 !important;
                z-index: 1000;
                display: flex !important;
                flex-direction: row;
                overflow-x: auto;
                padding: 8px;
                box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
                background: var(--bg-secondary) !important;
            }
            
            .main-content {
                margin-left: 0 !important;
                margin-top: 0 !important;
                width: 100% !important;
                padding: 12px !important;
                box-sizing: border-box;
            }
            
            .nav-section {
                display: flex;
                flex-direction: row;
                gap: 4px;
                margin: 0;
                padding: 0;
                border: none;
            }
            
            .nav-section-title {
                display: none;
            }
            
            .nav-item {
                flex-direction: column;
                padding: 8px 12px;
                font-size: 10px;
                gap: 2px;
            }
            
            .nav-item i {
                font-size: 16px;
            }
            
            .nav-item span:not(.nav-badge) {
                font-size: 9px;
            }
            
            .nav-badge {
                position: absolute;
                top: 2px;
                right: 2px;
                font-size: 8px;
                padding: 2px 4px;
            }
            
            .main-content {
                margin-bottom: 80px;
                padding: 12px;
            }
            
            .page-header h2 {
                font-size: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }
            
            .stat-card {
                padding: 16px;
            }
            
            .stat-value {
                font-size: 24px;
            }
            
            .card {
                margin-bottom: 12px;
            }
            
            .card-header {
                padding: 16px 16px 0;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .card-body {
                padding: 16px;
            }
            
            .header {
                padding: 12px;
            }
            
            .header h1 {
                font-size: 18px;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .modal {
                width: 95%;
                margin: 10px;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .kanban-board {
                flex-direction: column;
            }
            
            .kanban-column {
                min-width: 100%;
                margin-bottom: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                padding: 12px;
            }
            
            .stat-icon {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .page-header p {
                font-size: 14px;
            }
            
            .kanban-column {
                min-height: 200px;
            }
            
            .header {
                padding: 8px 12px;
                flex-wrap: wrap;
            }
            
            .header h1 {
                font-size: 16px;
            }
            
            .header-btn {
                width: 36px;
                height: 36px;
                padding: 0;
            }
        }
        
        /* Mobile Header */
        @media (max-width: 768px) {
            .header {
                padding: 8px 12px;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .header h1 {
                font-size: 16px;
            }
            
            .header-left {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .header-right {
                display: flex;
                gap: 4px;
            }
            
            .logo {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }
        }
            
            .stat-card {
                padding: 12px;
            }
            
            .stat-icon {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .page-header p {
                font-size: 14px;
            }
            
            .kanban-column {
                min-height: 200px;
            }
            
            .task-card {
                padding: 12px;
            }
        }
        
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.2s;
        }
        
        .card:hover {
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            padding: 24px 24px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title i {
            color: #3b82f6;
        }
        
        .card-body {
            padding: 24px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px -2px rgba(37, 99, 235, 0.3);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
            color: var(--text-primary);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 12px;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
        }
        
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .activity-item {
            display: flex;
            gap: 16px;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            transition: all 0.2s;
        }
        
        .activity-item:hover {
            background: #e2e8f0;
            transform: translateX(4px);
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-text {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .activity-time {
            font-size: 12px;
            color: var(--text-tertiary);
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .quick-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }
        
        .quick-action:hover {
            background: var(--bg-secondary);
            border-color: #bfdbfe;
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            color: #2563eb;
        }
        
        .quick-action i {
            font-size: 28px;
        }
        
        .quick-action span {
            font-size: 13px;
            font-weight: 600;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 90px;
            right: 32px;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .toast.success { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .toast.error { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .toast.info { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="brand">
            <div class="logo">
                <i class="fas fa-robot"></i>
            </div>
            <div class="brand-text">
                <h1>OpenClaw</h1>
                <span>Dashboard Pro v2.0</span>
            </div>
        </div>
        
        <div class="header-actions">
            <div class="status-indicator" id="botStatus">
                <div class="status-dot"></div>
                <span>Bot Online</span>
            </div>
            
            <button class="header-btn" onclick="showToast('Neue Benachrichtigungen verf√ºgbar!', 'info')">
                <i class="fas fa-bell"></i>
                <span class="notification-badge">3</span>
            </button>
            
            <button class="header-btn" onclick="showToast('Dark Mode kommt bald!', 'info')">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </header>

    <div class="layout">
        <aside class="sidebar">
            <div class="nav-section">
                <div class="nav-section-title">Hauptmen√º</div>
                
                <div class="nav-item active" onclick="showSection('overview', this)">
                    <i class="fas fa-chart-pie"></i>
                    <span>√úbersicht</span>
                </div>
                
                <div class="nav-item" onclick="showSection('projects', this)">
                    <i class="fas fa-folder-open"></i>
                    <span>Projekte</span>
                    <span class="nav-badge">5</span>
                </div>
                
                <div class="nav-item" onclick="showSection('tasks', this)">
                    <i class="fas fa-tasks"></i>
                    <span>Aufgaben</span>
                    <span class="nav-badge">12</span>
                </div>
                
                <div class="nav-item" onclick="showSection('kanban', this)">
                    <i class="fas fa-columns"></i>
                    <span>Kanban Board</span>
                </div>
                
                <div class="nav-item" onclick="showSection('apps', this)">
                    <i class="fas fa-rocket"></i>
                    <span>Meine Apps</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">KI & Automation</div>
                
                <div class="nav-item" onclick="showSection('bot', this)">
                    <i class="fas fa-terminal"></i>
                    <span>Bot Control</span>
                </div>
                
                <div class="nav-item" onclick="showSection('agents', this)">
                    <i class="fas fa-brain"></i>
                    <span>Agenten</span>
                </div>
                
                <div class="nav-item" onclick="showSection('newsletter', this)">
                    <i class="fas fa-envelope-open-text"></i>
                    <span>Newsletter</span>
                </div>
                
                <div class="nav-item" onclick="showSection('context', this)">
                    <i class="fas fa-book"></i>
                    <span>Context/Docs</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">System</div>
                
                <div class="nav-item" onclick="showSection('analytics', this)">
                    <i class="fas fa-chart-line"></i>
                    <span>Analytics</span>
                </div>
                
                <div class="nav-item" onclick="showSection('settings', this)">
                    <i class="fas fa-sliders-h"></i>
                    <span>Einstellungen</span>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-card">
                    <div class="user-avatar">JD</div>
                    <div class="user-info">
                        <div class="user-name">Admin User</div>
                        <div class="user-role">Administrator</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color: var(--text-tertiary);"></i>
                </div>
            </div>
        </aside>

        <main class="main-content" id="mainContent">
            <!-- Content wird dynamisch geladen -->
        </main>
    </div>

    <script>
        // Auth Configuration
        const AUTH_TOKEN_KEY = 'openclawAuthToken';
        const AUTH_USER_KEY = 'openclawUser';
        
        // Auth Functions
        async function login(username, password) {
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (data.token) {
                    localStorage.setItem(AUTH_TOKEN_KEY, data.token);
                    localStorage.setItem(AUTH_USER_KEY, JSON.stringify(data.user));
                    updateUserCard(data.user);
                    showToast('Erfolgreich eingeloggt!', 'success');
                    return true;
                } else {
                    showToast(data.error || 'Login fehlgeschlagen', 'error');
                    return false;
                }
            } catch (err) {
                showToast('Verbindungsfehler', 'error');
                return false;
            }
        }
        
        async function register(username, email, password) {
            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });
                
                const data = await response.json();
                
                if (data.token) {
                    localStorage.setItem(AUTH_TOKEN_KEY, data.token);
                    localStorage.setItem(AUTH_USER_KEY, JSON.stringify(data.user));
                    updateUserCard(data.user);
                    showToast('Account erstellt!', 'success');
                    return true;
                } else {
                    showToast(data.error || 'Registrierung fehlgeschlagen', 'error');
                    return false;
                }
            } catch (err) {
                showToast('Verbindungsfehler', 'error');
                return false;
            }
        }
        
        function logout() {
            localStorage.removeItem(AUTH_TOKEN_KEY);
            localStorage.removeItem(AUTH_USER_KEY);
            updateUserCard(null);
            showToast('Ausgeloggt', 'info');
            renderLoginModal();
        }
        
        function getAuthToken() {
            return localStorage.getItem(AUTH_TOKEN_KEY);
        }
        
        function getCurrentUser() {
            const user = localStorage.getItem(AUTH_USER_KEY);
            return user ? JSON.parse(user) : null;
        }
        
        function updateUserCard(user) {
            const userCard = document.querySelector('.user-card');
            if (!userCard) return;
            
            if (user) {
                const initials = user.username.substring(0, 2).toUpperCase();
                const roleLabel = user.role === 'admin' ? 'Administrator' : 'Benutzer';
                userCard.innerHTML = `
                    <div class="user-avatar" style="background: var(--primary-500);">${initials}</div>
                    <div class="user-info">
                        <div class="user-name">${user.username}</div>
                        <div class="user-role">${roleLabel}</div>
                    </div>
                    <i class="fas fa-sign-out-alt" style="color: var(--text-tertiary); cursor: pointer;" onclick="logout()" title="Ausloggen"></i>
                `;
            } else {
                userCard.innerHTML = `
                    <div class="user-avatar" style="background: var(--bg-tertiary); color: var(--text-secondary);">?</div>
                    <div class="user-info">
                        <div class="user-name" style="cursor: pointer;" onclick="renderLoginModal()">Einloggen</div>
                        <div class="user-role">Klicken zum Anmelden</div>
                    </div>
                `;
            }
        }
        
        function renderLoginModal() {
            const modal = document.createElement('div');
            modal.id = 'loginModal';
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px; padding: 32px;">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <h2 style="margin: 0 0 8px 0;">üîê OpenClaw Login</h2>
                        <p style="color: var(--text-secondary); margin: 0;">Melde dich an oder erstelle einen Account</p>
                    </div>
                    
                    <div id="loginForm">
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">Benutzername</label>
                            <input type="text" id="loginUsername" placeholder="Benutzername" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-tertiary); box-sizing: border-box;">
                        </div>
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">Passwort</label>
                            <input type="password" id="loginPassword" placeholder="Passwort" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-tertiary); box-sizing: border-box;">
                        </div>
                        <button class="btn btn-primary" style="width: 100%; padding: 12px;" onclick="handleLogin()">
                            <i class="fas fa-sign-in-alt"></i> Einloggen
                        </button>
                        <div style="text-align: center; margin-top: 16px;">
                            <a href="#" onclick="toggleAuthMode(event)" style="color: var(--primary-500);">Noch kein Account? Registrieren</a>
                        </div>
                    </div>
                    
                    <div id="registerForm" style="display: none;">
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">Benutzername</label>
                            <input type="text" id="regUsername" placeholder="Benutzername" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-tertiary); box-sizing: border-box;">
                        </div>
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">E-Mail</label>
                            <input type="email" id="regEmail" placeholder="email@beispiel.de" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-tertiary); box-sizing: border-box;">
                        </div>
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">Passwort</label>
                            <input type="password" id="regPassword" placeholder="Mindestens 6 Zeichen" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-tertiary); box-sizing: border-box;">
                        </div>
                        <button class="btn btn-primary" style="width: 100%; padding: 12px;" onclick="handleRegister()">
                            <i class="fas fa-user-plus"></i> Registrieren
                        </button>
                        <div style="text-align: center; margin-top: 16px;">
                            <a href="#" onclick="toggleAuthMode(event)" style="color: var(--primary-500);">Bereits einen Account? Einloggen</a>
                        </div>
                    </div>
                    
                    <button class="modal-close" onclick="closeLoginModal()" style="position: absolute; top: 16px; right: 16px; background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-tertiary);">&times;</button>
                </div>
            `;
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeLoginModal();
            });
        }
        
        function toggleAuthMode(e) {
            e.preventDefault();
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            if (loginForm.style.display === 'none') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            }
        }
        
        async function handleLogin() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showToast('Bitte Benutzername und Passwort eingeben', 'warning');
                return;
            }
            
            const success = await login(username, password);
            if (success) {
                closeLoginModal();
            }
        }
        
        async function handleRegister() {
            const username = document.getElementById('regUsername').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const password = document.getElementById('regPassword').value;
            
            if (!username || !email || !password) {
                showToast('Bitte alle Felder ausf√ºllen', 'warning');
                return;
            }
            
            if (password.length < 6) {
                showToast('Passwort muss mindestens 6 Zeichen haben', 'warning');
                return;
            }
            
            const success = await register(username, email, password);
            if (success) {
                closeLoginModal();
            }
        }
        
        function closeLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) modal.remove();
        }
        
        // User Management
        async function loadUserManagement() {
            const container = document.getElementById('userManagement');
            if (!container) return;
            
            try {
                const response = await fetch(`${API_URL}/auth/users`, {
                    headers: { 'Authorization': `Bearer ${getAuthToken()}` }
                });
                
                if (!response.ok) throw new Error('Keine Berechtigung');
                
                const users = await response.json();
                
                container.innerHTML = `
                    <div style="display: flex; flex-direction: column; gap: 12px; max-height: 400px; overflow-y: auto;">
                        ${users.map(user => `
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg-tertiary); border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: ${user.role === 'admin' ? 'var(--primary-500)' : 'var(--bg-secondary)'}; display: flex; align-items: center; justify-content: center; color: ${user.role === 'admin' ? '#fff' : 'var(--text-secondary)'}; font-weight: 600;">
                                        ${user.username.substring(0,2).toUpperCase()}
                                    </div>
                                    <div>
                                        <div style="font-weight: 600;">${user.username}</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">${user.email}</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 12px; padding: 4px 8px; border-radius: 4px; background: ${user.role === 'admin' ? '#dbeafe' : '#f3f4f6'}; color: ${user.role === 'admin' ? '#1d4ed8' : '#6b7280'};">
                                        ${user.role === 'admin' ? 'Admin' : 'User'}
                                    </span>
                                    <span style="font-size: 12px; padding: 4px 8px; border-radius: 4px; background: ${user.is_active ? '#dcfce7' : '#fee2e2'}; color: ${user.is_active ? '#16a34a' : '#dc2626'};">
                                        ${user.is_active ? 'Aktiv' : 'Inaktiv'}
                                    </span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                        <p style="font-size: 12px; color: var(--text-tertiary);">
                            <i class="fas fa-info-circle"></i> Der erste registrierte Benutzer ist automatisch Admin.
                        </p>
                    </div>
                `;
            } catch (err) {
                container.innerHTML = `<div style="color: var(--text-error);">Fehler beim Laden: ${err.message}</div>`;
            }
        }
        
        // API Configuration
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3002/api' 
            : '/api';
        
        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // Check auth status
                const user = getCurrentUser();
                if (user) {
                    updateUserCard(user);
                } else {
                    renderLoginModal();
                }
                
                renderOverview();
                showToast('Willkommen im neuen OpenClaw Dashboard Pro! üéâ', 'success');
            } catch (e) {
                console.error('Init error:', e);
                document.getElementById('mainContent').innerHTML = '<div style="padding: 40px; text-align: center;"><h2>Fehler beim Laden</h2><pre>' + e.message + '</pre></div>';
            }
        });

        // Toast Notification System
        function showToast(message, type = 'info') {
            // Remove existing toasts
            document.querySelectorAll('.toast').forEach(t => t.remove());
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation' : 'info'}-circle"></i> ${message}`;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Navigation
        function showSection(section, element) {
            // Update active state
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if (element && element.classList) {
                element.classList.add('active');
            } else if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
            
            // Fade out
            const content = document.getElementById('mainContent');
            content.style.opacity = '0';
            
            setTimeout(() => {
                switch(section) {
                    case 'overview':
                        renderOverview();
                        break;
                    case 'projects':
                        renderProjects();
                        break;
                    case 'tasks':
                        renderTasks();
                        break;
                    case 'kanban':
                        renderKanban();
                        break;
                    case 'apps':
                        renderApps();
                        break;
                    case 'bot':
                        renderBot();
                        break;
                    case 'agents':
                        renderAgents();
                        break;
                    case 'newsletter':
                        renderNewsletter();
                        break;
                    case 'context':
                        renderContext();
                        break;
                    case 'analytics':
                        renderAnalytics();
                        break;
                    case 'settings':
                        renderSettings();
                        break;
                    default:
                        renderComingSoon(section);
                }
                content.style.opacity = '1';
                content.style.transition = 'opacity 0.3s';
            }, 200);
        }

        // Render Overview
        function renderOverview() {
            document.getElementById('mainContent').innerHTML = `
                <div class="page-header">
                    <h2>Dashboard √úbersicht</h2>
                    <p>Willkommen im neuen professionellen Design! Hier ist Ihr aktueller Status.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">
                                <i class="fas fa-folder"></i>
                            </div>
                            <div class="stat-trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>+12%</span>
                            </div>
                        </div>
                        <div class="stat-value">12</div>
                        <div class="stat-label">Aktive Projekte</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 75%"></div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon purple">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>+8%</span>
                            </div>
                        </div>
                        <div class="stat-value">48</div>
                        <div class="stat-label">Erledigte Tasks</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 60%"></div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon green">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <div class="stat-trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>+24%</span>
                            </div>
                        </div>
                        <div class="stat-value">24</div>
                        <div class="stat-label">Generierte Apps</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 85%"></div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon orange">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="stat-trend down">
                                <i class="fas fa-arrow-down"></i>
                                <span>-3%</span>
                            </div>
                        </div>
                        <div class="stat-value">6</div>
                        <div class="stat-label">Aktive Agenten</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 90%"></div>
                        </div>
                    </div>
                </div>

                <div class="content-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <i class="fas fa-history"></i>
                                Letzte Aktivit√§ten
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="activity-list">
                                <div class="activity-item">
                                    <div class="activity-icon" style="background: #f0fdf4; color: #16a34a;">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-text">
                                            <strong>Dashboard Pro v2.0</strong> wurde aktiviert
                                        </div>
                                        <div class="activity-time">Gerade eben</div>
                                    </div>
                                </div>

                                <div class="activity-item">
                                    <div class="activity-icon" style="background: #eff6ff; color: #2563eb;">
                                        <i class="fas fa-magic"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-text">
                                            Neues Design mit <strong>modernem UI</strong> verf√ºgbar
                                        </div>
                                        <div class="activity-time">Vor 2 Minuten</div>
                                    </div>
                                </div>

                                <div class="activity-item">
                                    <div class="activity-icon" style="background: #f3e8ff; color: #7c3aed;">
                                        <i class="fas fa-envelope"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-text">
                                            <strong>Newsletter Feature</strong> wurde hinzugef√ºgt
                                        </div>
                                        <div class="activity-time">Vor 5 Minuten</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="card" style="margin-bottom: 24px;">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-bolt"></i>
                                    Schnellzugriff
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="quick-actions">
                                    <div class="quick-action" onclick="createProjectQuick()">
                                        <i class="fas fa-plus-circle"></i>
                                        <span>Neues Projekt</span>
                                    </div>
                                    <div class="quick-action" onclick="createTaskQuick()">
                                        <i class="fas fa-clipboard-list"></i>
                                        <span>Task erstellen</span>
                                    </div>
                                    <div class="quick-action" onclick="showSection('bot', this)">
                                        <i class="fas fa-code"></i>
                                        <span>Code generieren</span>
                                    </div>
                                    <div class="quick-action" onclick="showSection('newsletter', this)">
                                        <i class="fas fa-paper-plane"></i>
                                        <span>Newsletter</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-chart-line"></i>
                                    System-Status
                                </div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 16px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="color: var(--text-secondary);">API Latenz</span>
                                        <span style="font-weight: 600; color: #16a34a;">24ms</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="color: var(--text-secondary);">Datenbank</span>
                                        <span style="font-weight: 600; color: #16a34a;">Verbunden</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="color: var(--text-secondary);">Version</span>
                                        <span style="font-weight: 600;">v2.0.0 Pro</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render Newsletter
        function renderNewsletter() {
            document.getElementById('mainContent').innerHTML = `
                <div class="page-header">
                    <h2>üìß Newsletter Manager</h2>
                    <p>Erstellen und senden Sie Newsletter √ºber WhatsApp, Telegram & Signal.</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-pen-fancy"></i>
                            Newsletter erstellen
                        </div>
                    </div>
                    <div class="card-body">
                        <form onsubmit="sendNewsletter(event)">
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Titel</label>
                                <input type="text" id="newsletterTitle" required
                                    style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 12px; font-size: 14px;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Kan√§le</label>
                                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                    <label style="display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: var(--bg-tertiary); border-radius: 10px; cursor: pointer;">
                                        <input type="checkbox" name="channels" value="email" checked>
                                        <i class="fas fa-envelope" style="color: #3b82f6;"></i>
                                        <span>E-Mail</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: var(--bg-tertiary); border-radius: 10px; cursor: pointer;">
                                        <input type="checkbox" name="channels" value="whatsapp">
                                        <i class="fab fa-whatsapp" style="color: #25d366;"></i>
                                        <span>WhatsApp</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: var(--bg-tertiary); border-radius: 10px; cursor: pointer;">
                                        <input type="checkbox" name="channels" value="telegram">
                                        <i class="fab fa-telegram" style="color: #0088cc;"></i>
                                        <span>Telegram</span>
                                    </label>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Inhalt</label>
                                <textarea id="newsletterContent" rows="6" required
                                    style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 12px; font-size: 14px; resize: vertical;"
                                    placeholder="Ihre Nachricht..."></textarea>
                            </div>

                            <div style="display: flex; gap: 12px;">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i>
                                    Newsletter senden
                                </button>
                                <button type="button" class="btn btn-success" onclick="generateAINewsletter()">
                                    <i class="fas fa-robot"></i>
                                    Mit KI generieren
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        // Newsletter Functions
        async function sendNewsletter(e) {
            e.preventDefault();
            
            const title = document.getElementById('newsletterTitle').value;
            const content = document.getElementById('newsletterContent').value;
            
            // Kan√§le sammeln
            const channels = [];
            document.querySelectorAll('input[name="channels"]:checked').forEach(cb => {
                channels.push(cb.value);
            });
            
            if (channels.length === 0) {
                showToast('Bitte mindestens einen Kanal ausw√§hlen!', 'warning');
                return;
            }
            
            showToast(`Newsletter "${title}" wird gesendet...`, 'info');
            
            try {
                const response = await fetch(`${API_URL}/newsletter/send`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title,
                        content,
                        channels,
                        recipients: {
                            email: [localStorage.getItem('notificationEmail') || ''],
                            telegram: [localStorage.getItem('telegramChatId') || ''],
                            whatsapp: [localStorage.getItem('whatsappPhone') || '']
                        }
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    let successMsg = 'Newsletter gesendet!';
                    const details = [];
                    if (result.results.email?.success) details.push(`E-Mail: ${result.results.email.count}`);
                    if (result.results.telegram?.success) details.push(`Telegram: ${result.results.telegram.count}`);
                    if (result.results.whatsapp?.success) details.push(`WhatsApp: ${result.results.whatsapp.count}`);
                    
                    if (details.length > 0) {
                        successMsg += ` (${details.join(', ')})`;
                    }
                    
                    showToast(successMsg, 'success');
                    document.querySelector('form').reset();
                    
                    // Log speichern
                    if (result.logId) {
                        saveToStorage();
                    }
                } else {
                    const errors = [];
                    if (result.results?.email?.error) errors.push(`E-Mail: ${result.results.email.error}`);
                    if (result.results?.telegram?.error) errors.push(`Telegram: ${result.results.telegram.error}`);
                    if (result.results?.whatsapp?.error) errors.push(`WhatsApp: ${result.results.whatsapp.error}`);
                    
                    if (errors.length > 0) {
                        showToast(`Fehler: ${errors.join(', ')}`, 'error');
                    } else {
                        showToast('Newsletter konnte nicht gesendet werden', 'error');
                    }
                }
            } catch (error) {
                console.error('Newsletter Fehler:', error);
                showToast('Verbindungsfehler zum Server', 'error');
            }
        }

        async function generateAINewsletter() {
            showToast('KI generiert Newsletter...', 'info');
            
            try {
                // KI-Integration f√ºr Newsletter-Generierung
                const response = await fetch(`${API_URL}/newsletter/templates`);
                const result = await response.json();
                
                if (result.success && result.templates.length > 0) {
                    // Zuf√§llige Vorlage ausw√§hlen oder die Update-Vorlage nehmen
                    const template = result.templates.find(t => t.id === 'update') || result.templates[0];
                    
                    document.getElementById('newsletterTitle').value = template.title;
                    document.getElementById('newsletterContent').value = template.content;
                    showToast('Newsletter-Vorlage geladen!', 'success');
                } else {
                    // Fallback
                    document.getElementById('newsletterTitle').value = 'OpenClaw Pro Update';
                    document.getElementById('newsletterContent').value = `üéâ OpenClaw Dashboard Pro ist jetzt live!

Neue Features:
‚ú® Modernes, professionelles Design
üì± Verbesserte Navigation
üìß Integrierter Newsletter Manager
ü§ñ Erweiterte KI-Agenten

Vielen Dank f√ºr Ihre Unterst√ºtzung!

Ihr OpenClaw Team`;
                    showToast('Newsletter-Vorlage generiert!', 'success');
                }
            } catch (error) {
                console.error('Fehler beim Laden der Vorlage:', error);
                // Fallback bei Fehler
                document.getElementById('newsletterTitle').value = 'OpenClaw Pro Update';
                document.getElementById('newsletterContent').value = `üéâ OpenClaw Dashboard Pro ist jetzt live!

Neue Features:
‚ú® Modernes, professionelles Design
üì± Verbesserte Navigation
üìß Integrierter Newsletter Manager
ü§ñ Erweiterte KI-Agenten

Vielen Dank f√ºr Ihre Unterst√ºtzung!

Ihr OpenClaw Team`;
                showToast('Newsletter-Vorlage generiert!', 'success');
            }
        }
        
        // Newsletter Verlauf laden
        async function loadNewsletterLogs() {
            try {
                const response = await fetch(`${API_URL}/newsletter/logs?limit=10`);
                const result = await response.json();
                
                if (result.success) {
                    return result.logs;
                }
            } catch (error) {
                console.error('Fehler beim Laden der Logs:', error);
            }
            return [];
        }
        
        // Newsletter Statistiken laden
        async function loadNewsletterStats() {
            try {
                const response = await fetch(`${API_URL}/newsletter/stats`);
                const result = await response.json();
                
                if (result.success) {
                    return result.stats;
                }
            } catch (error) {
                console.error('Fehler beim Laden der Statistiken:', error);
            }
            return null;
        }

        // Global state for data
        let appData = {
            projects: [],
            tasks: [],
            apps: [],
            botLogs: []
        };

        // ü§ñ AI MODEL REGISTRY - Zentrale Modell-Datenbank
        const AI_MODEL_REGISTRY = {
            version: '1.0',
            lastUpdated: '2026-02-14',
            
            // Kostenlose Modelle
            free: [
                {
                    id: 'kimi-k2.5-free',
                    name: 'Kimi K2.5',
                    provider: 'Moonshot AI',
                    tier: 'free',
                    description: 'Leistungsstarkes kostenloses Modell mit 200K Context',
                    specs: {
                        contextWindow: 200000,
                        maxTokens: 8000,
                        supportsVision: false,
                        supportsFunctions: true,
                        languages: ['de', 'en', 'zh']
                    },
                    useCases: ['code', 'documentation', 'chat'],
                    limitations: {
                        rateLimit: '20 requests/min',
                        availability: 'Best effort'
                    },
                    cost: { input: 0, output: 0, currency: 'USD' },
                    endpoint: 'https://api.moonshot.cn/v1',
                    status: 'active'
                },
                {
                    id: 'ollama-codellama',
                    name: 'CodeLlama (Local)',
                    provider: 'Ollama',
                    tier: 'free',
                    description: 'Lokales Modell f√ºr maximale Privatsph√§re',
                    specs: {
                        contextWindow: 16000,
                        maxTokens: 4000,
                        supportsVision: false,
                        requiresGPU: true,
                        languages: ['de', 'en']
                    },
                    useCases: ['code', 'offline'],
                    limitations: {
                        quality: 'Medium',
                        speed: 'Depends on hardware'
                    },
                    cost: { input: 0, output: 0, hardware: 'GPU required' },
                    endpoint: 'http://localhost:11434',
                    status: 'optional'
                }
            ],
            
            // Budget-Modelle (Low-Cost)
            budget: [
                {
                    id: 'gpt-4o-mini',
                    name: 'GPT-4o Mini',
                    provider: 'OpenAI',
                    tier: 'budget',
                    description: 'Kosteneffizientes Modell f√ºr t√§gliche Aufgaben',
                    specs: {
                        contextWindow: 128000,
                        maxTokens: 16000,
                        supportsVision: true,
                        supportsFunctions: true,
                        languages: ['multilingual']
                    },
                    useCases: ['documentation', 'quick-tasks', 'testing'],
                    cost: { input: 0.00015, output: 0.0006, currency: 'USD' },
                    endpoint: 'https://api.openai.com/v1',
                    status: 'active'
                }
            ],
            
            // Premium Modelle (High-Quality)
            premium: [
                {
                    id: 'gpt-4o',
                    name: 'GPT-4o',
                    provider: 'OpenAI',
                    tier: 'premium',
                    description: 'Hochwertiges Modell f√ºr komplexe Aufgaben',
                    specs: {
                        contextWindow: 128000,
                        maxTokens: 16000,
                        supportsVision: true,
                        supportsFunctions: true,
                        reasoning: 'Advanced',
                        languages: ['multilingual']
                    },
                    useCases: ['complex-architecture', 'critical-decisions', 'analysis'],
                    cost: { input: 0.0025, output: 0.01, currency: 'USD' },
                    endpoint: 'https://api.openai.com/v1',
                    status: 'active'
                },
                {
                    id: 'claude-sonnet-4',
                    name: 'Claude Sonnet 4',
                    provider: 'Anthropic',
                    tier: 'premium',
                    description: 'Ausgewogenes Premium-Modell mit 200K Context',
                    specs: {
                        contextWindow: 200000,
                        maxTokens: 8000,
                        supportsVision: true,
                        reasoning: 'Advanced',
                        languages: ['multilingual']
                    },
                    useCases: ['code-review', 'analysis', 'planning'],
                    cost: { input: 0.003, output: 0.015, currency: 'USD' },
                    endpoint: 'https://api.anthropic.com/v1',
                    status: 'active'
                }
            ],
            
            // Ultra-Premium (Best Quality)
            ultra: [
                {
                    id: 'claude-opus-4',
                    name: 'Claude Opus 4',
                    provider: 'Anthropic',
                    tier: 'ultra',
                    description: 'Bestes Modell f√ºr strategische Planung',
                    specs: {
                        contextWindow: 200000,
                        maxTokens: 8000,
                        supportsVision: true,
                        reasoning: 'Expert',
                        nuance: 'Excellent',
                        languages: ['multilingual']
                    },
                    useCases: ['strategic-planning', 'complex-analysis', 'architecture'],
                    cost: { input: 0.015, output: 0.075, currency: 'USD' },
                    endpoint: 'https://api.anthropic.com/v1',
                    status: 'active'
                }
            ],
            
            // Model ausw√§hlen basierend auf Anforderungen
            selectModel(requirements) {
                const { tier, useCase, maxCost } = requirements;
                
                let candidates = [];
                
                // Nach Tier filtern
                if (tier) {
                    candidates = this[tier] || [];
                } else {
                    candidates = [...this.free, ...this.budget, ...this.premium];
                }
                
                // Nach Use Case filtern
                if (useCase) {
                    candidates = candidates.filter(m => m.useCases.includes(useCase));
                }
                
                // Nach Kosten filtern
                if (maxCost) {
                    candidates = candidates.filter(m => m.cost.output <= maxCost);
                }
                
                // Nach Status filtern
                candidates = candidates.filter(m => m.status === 'active');
                
                // Bestes Modell zur√ºckgeben (erstes in Liste)
                return candidates[0] || this.free[0];
            },
            
            // Alle aktiven Modelle auflisten
            getAllActive() {
                return [
                    ...this.free.filter(m => m.status === 'active'),
                    ...this.budget.filter(m => m.status === 'active'),
                    ...this.premium.filter(m => m.status === 'active'),
                    ...this.ultra.filter(m => m.status === 'active')
                ];
            }
        };

        // ü§ñ AGENT CONFIGURATION
        // Alle Agenten haben feste Rollen, aber √§nderbare Modelle
        // Code-Architect ist auf Kimi fixiert (locked: true)
        const AGENT_TEMPLATES = {
            'code-architect': {
                name: 'Code-Architect',
                role: 'Senior Developer',
                description: 'Spezialisiert auf Code-Generierung und Architektur',
                defaultModel: 'kimi-k2.5-free',
                fallbackModels: ['gpt-4o-mini', 'ollama-codellama'],
                capabilities: ['react-components', 'api-endpoints', 'database-design', 'optimization'],
                maxCostPerTask: 0.10,
                preferredTier: 'free',
                locked: true,  // üîí Fest auf Kimi
                lockedReason: 'Code-Architect arbeitet optimal mit Kimi'
            },
            'doc-writer': {
                name: 'Doc-Writer',
                role: 'Technical Writer',
                description: 'Erstellt Dokumentation und READMEs',
                defaultModel: 'gpt-4o-mini',
                fallbackModels: ['kimi-k2.5-free', 'claude-sonnet-4'],
                capabilities: ['markdown', 'api-docs', 'user-guides', 'comments'],
                maxCostPerTask: 0.05,
                preferredTier: 'budget',
                locked: false  // Modell √§nderbar
            },
            'planner': {
                name: 'Project-Planner',
                role: 'Solution Architect',
                description: 'Strategische Planung und Architektur',
                defaultModel: 'claude-opus-4',
                fallbackModels: ['gpt-4o', 'claude-sonnet-4'],
                capabilities: ['architecture', 'planning', 'decisions', 'analysis'],
                maxCostPerTask: 0.50,
                preferredTier: 'ultra',
                locked: false  // Modell √§nderbar
            },
            'debugger': {
                name: 'Debug-Assistant',
                role: 'QA Engineer',
                description: 'Fehleranalyse und Behebung',
                defaultModel: 'kimi-k2.5-free',
                fallbackModels: ['gpt-4o-mini', 'ollama-codellama'],
                capabilities: ['error-analysis', 'fix-suggestions', 'testing'],
                maxCostPerTask: 0.05,
                preferredTier: 'free',
                locked: false  // Modell √§nderbar
            },
            'tester': {
                name: 'Test-Engineer',
                role: 'QA Specialist',
                description: 'Test-Generierung und Qualit√§tssicherung',
                defaultModel: 'gpt-4o-mini',
                fallbackModels: ['kimi-k2.5-free', 'ollama-codellama'],
                capabilities: ['unit-tests', 'integration-tests', 'edge-cases'],
                maxCostPerTask: 0.03,
                preferredTier: 'budget',
                locked: false  // Modell √§nderbar
            },
            'reviewer': {
                name: 'Code-Reviewer',
                role: 'Senior Reviewer',
                description: 'Code-Reviews und Qualit√§tspr√ºfung',
                defaultModel: 'claude-sonnet-4',
                fallbackModels: ['gpt-4o', 'kimi-k2.5-free'],
                capabilities: ['quality-check', 'security-audit', 'best-practices'],
                maxCostPerTask: 0.20,
                preferredTier: 'premium',
                locked: false  // Modell √§nderbar
            }
        };

        // Load saved data from localStorage
        function loadFromStorage() {
            try {
                const saved = localStorage.getItem('openclawData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    appData.projects = parsed.projects || [];
                    appData.tasks = parsed.tasks || [];
                    appData.apps = parsed.apps || [];
                    appData.botLogs = parsed.botLogs || [];
                    console.log('‚úÖ Daten aus localStorage geladen');
                }
            } catch (e) {
                console.error('Fehler beim Laden:', e);
            }
        }

        // Save data to localStorage
        function saveToStorage() {
            try {
                localStorage.setItem('openclawData', JSON.stringify(appData));
            } catch (e) {
                console.error('Fehler beim Speichern:', e);
            }
        }

        // Load on startup
        loadFromStorage();
        
        // Load saved agent configurations
        function loadAgentConfigs() {
            try {
                const saved = localStorage.getItem('agentConfigs');
                if (saved) {
                    const configs = JSON.parse(saved);
                    Object.entries(configs).forEach(([agentKey, config]) => {
                        if (AGENT_TEMPLATES[agentKey] && !AGENT_TEMPLATES[agentKey].locked) {
                            AGENT_TEMPLATES[agentKey].defaultModel = config.defaultModel;
                        }
                    });
                    console.log('‚úÖ Agenten-Konfigurationen geladen');
                }
            } catch (e) {
                console.error('Fehler beim Laden der Agenten-Configs:', e);
            }
        }
        loadAgentConfigs();
        
        // Theme Management
        const THEME_KEY = 'openclawTheme';
        
        function initTheme() {
            const savedTheme = localStorage.getItem(THEME_KEY) || 'light';
            setTheme(savedTheme);
        }
        
        function setTheme(theme) {
            const html = document.documentElement;
            
            if (theme === 'auto') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                html.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
            } else {
                html.setAttribute('data-theme', theme);
            }
            
            localStorage.setItem(THEME_KEY, theme);
            console.log(`Theme gesetzt: ${theme}`);
        }
        
        function getCurrentTheme() {
            return localStorage.getItem(THEME_KEY) || 'light';
        }
        
        // Initialize theme on load
        initTheme();
        
        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            const savedTheme = localStorage.getItem(THEME_KEY);
            if (savedTheme === 'auto') {
                setTheme('auto');
            }
        });
        
        // API Keys Management
        const API_KEYS_KEY = 'openclawApiKeys';
        
        function saveApiKey(provider, key) {
            try {
                const keys = JSON.parse(localStorage.getItem(API_KEYS_KEY) || '{}');
                keys[provider] = key;
                localStorage.setItem(API_KEYS_KEY, JSON.stringify(keys));
                return true;
            } catch (e) {
                console.error('Fehler beim Speichern des API Keys:', e);
                return false;
            }
        }
        
        function getApiKey(provider) {
            try {
                const keys = JSON.parse(localStorage.getItem(API_KEYS_KEY) || '{}');
                return keys[provider] || '';
            } catch (e) {
                return '';
            }
        }
        
        function deleteApiKey(provider) {
            try {
                const keys = JSON.parse(localStorage.getItem(API_KEYS_KEY) || '{}');
                delete keys[provider];
                localStorage.setItem(API_KEYS_KEY, JSON.stringify(keys));
                return true;
            } catch (e) {
                return false;
            }
        }
        
        function getAllApiKeys() {
            try {
                return JSON.parse(localStorage.getItem(API_KEYS_KEY) || '{}');
            } catch (e) {
                return {};
            }
        }

        // Check if data is already initialized
        let dataInitialized = false;
        
        // Load data from API
        async function loadData() {
            // Don't reload if we already have user-created data
            if (dataInitialized && (appData.projects.length > 3 || appData.tasks.length > 4)) {
                return; // Keep user data
            }
            
            try {
                const [projectsRes, tasksRes] = await Promise.all([
                    fetch('/api/projects').catch(() => ({json: () => []})),
                    fetch('/api/tasks').catch(() => ({json: () => []}))
                ]);
                
                const apiProjects = await projectsRes.json().catch(() => []);
                const apiTasks = await tasksRes.json().catch(() => []);
                
                // Only use API data if available
                if (apiProjects && apiProjects.length > 0) {
                    appData.projects = apiProjects;
                } else if (!dataInitialized) {
                    // Initial demo data only once
                    appData.projects = [
                        { id: 1, title: 'OpenClaw Dashboard', description: 'Hauptprojekt', status: 'active', created_at: new Date().toISOString() },
                        { id: 2, title: 'KI Integration', description: 'AI Modelle', status: 'in_progress', created_at: new Date().toISOString() },
                        { id: 3, title: 'Mobile App', description: 'Responsive Design', status: 'active', created_at: new Date().toISOString() }
                    ];
                }
                
                if (apiTasks && apiTasks.length > 0) {
                    appData.tasks = apiTasks;
                } else if (!dataInitialized) {
                    appData.tasks = [
                        { id: 1, title: 'Dashboard Design', status: 'done', priority: 'high', project_id: 1 },
                        { id: 2, title: 'API Integration', status: 'in_progress', priority: 'high', project_id: 1 },
                        { id: 3, title: 'Bot Training', status: 'open', priority: 'medium', project_id: 2 },
                        { id: 4, title: 'Testing', status: 'open', priority: 'low', project_id: 1 }
                    ];
                }
                
                dataInitialized = true;
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Fehler beim Laden der Daten', 'error');
            }
        }

        // Render Projects
        async function renderProjects() {
            await loadData();
            const projects = appData.projects || [];
            
            document.getElementById('mainContent').innerHTML = `
                <div class="page-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2>üìÅ Projekte</h2>
                            <p>Verwalten Sie Ihre Projekte und √ºberwachen Sie den Fortschritt.</p>
                        </div>
                        <button class="btn btn-primary" onclick="createProject()">
                            <i class="fas fa-plus"></i> Neues Projekt
                        </button>
                    </div>
                </div>

                <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 24px;">
                    <div class="stat-card blue">
                        <div class="stat-value">${projects.filter(p => p.status === 'active').length}</div>
                        <div class="stat-label">Aktive Projekte</div>
                    </div>
                    <div class="stat-card purple">
                        <div class="stat-value">${projects.filter(p => p.status === 'completed').length}</div>
                        <div class="stat-label">Abgeschlossen</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-value">${projects.filter(p => p.status === 'on_hold').length}</div>
                        <div class="stat-label">Pausiert</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-list"></i> Alle Projekte
                        </div>
                    </div>
                    <div class="card-body">
                        ${projects.length === 0 ? '<p style="text-align: center; color: var(--text-tertiary);">Keine Projekte vorhanden</p>' : `
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            ${projects.map(project => `
                                <div style="display: flex; align-items: center; gap: 16px; padding: 16px; background: var(--bg-tertiary); border-radius: 12px; border-left: 4px solid ${getStatusColor(project.status)};">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 700; font-size: 16px; margin-bottom: 4px;">${project.title}</div>
                                        <div style="color: var(--text-secondary); font-size: 14px;">${project.description || 'Keine Beschreibung'}</div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="padding: 6px 12px; background: ${getStatusBg(project.status)}; color: ${getStatusColor(project.status)}; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase;">
                                            ${project.status}
                                        </span>
                                        <button class="btn btn-secondary btn-sm" onclick="editProject(${project.id})">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-secondary btn-sm" style="background: #fee2e2; color: #dc2626;" onclick="deleteProject(${project.id})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        `}
                    </div>
                </div>
            `;
        }

        // Render Tasks
        async function renderTasks() {
            await loadData();
            const tasks = appData.tasks || [];
            
            document.getElementById('mainContent').innerHTML = `
                <div class="page-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2>‚úÖ Aufgaben</h2>
                            <p>Verwalten Sie Ihre Aufgaben und To-Dos.</p>
                        </div>
                        <button class="btn btn-primary" onclick="createTask()">
                            <i class="fas fa-plus"></i> Neue Aufgabe
                        </button>
                    </div>
                </div>

                <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-value">${tasks.length}</div>
                        <div class="stat-label">Gesamt</div>
                    </div>
                    <div class="stat-card blue">
                        <div class="stat-value">${tasks.filter(t => t.status === 'open').length}</div>
                        <div class="stat-label">Offen</div>
                    </div>
                    <div class="stat-card purple">
                        <div class="stat-value">${tasks.filter(t => t.status === 'in_progress').length}</div>
                        <div class="stat-label">In Arbeit</div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-value">${tasks.filter(t => t.status === 'done').length}</div>
                        <div class="stat-label">Erledigt</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-tasks"></i> Aufgabenliste
                        </div>
                        <div class="card-actions">
                            <select class="btn btn-secondary" style="padding: 8px 12px;" onchange="filterTasks(this.value)">
                                <option value="all">Alle Status</option>
                                <option value="open">Offen</option>
                                <option value="in_progress">In Arbeit</option>
                                <option value="done">Erledigt</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        ${tasks.length === 0 ? '<p style="text-align: center; color: var(--text-tertiary);">Keine Aufgaben vorhanden</p>' : `
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            ${tasks.map(task => `
                                <div style="display: flex; align-items: center; gap: 16px; padding: 16px; background: var(--bg-tertiary); border-radius: 12px;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <input type="checkbox" ${task.status === 'done' ? 'checked' : ''} 
                                            onchange="toggleTaskStatus(${task.id}, this.checked)"
                                            style="width: 20px; height: 20px; cursor: pointer;">
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; ${task.status === 'done' ? 'text-decoration: line-through; color: var(--text-tertiary);' : ''}">${task.title}</div>
                                        <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 4px;">
                                            <span style="padding: 2px 8px; background: ${getPriorityColor(task.priority)}; border-radius: 4px; color: white; margin-right: 8px;">${task.priority}</span>
                                            Projekt #${task.project_id}
                                        </div>
                                    </div>
                                    <span style="padding: 6px 12px; background: ${getStatusBg(task.status)}; color: ${getStatusColor(task.status)}; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                        ${task.status === 'open' ? 'Offen' : task.status === 'in_progress' ? 'In Arbeit' : 'Erledigt'}
                                    </span>
                                    <button class="btn btn-secondary btn-sm" style="background: #fee2e2; color: #dc2626;" onclick="deleteTask(${task.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        `}
                    </div>
                </div>
            `;
        }

        // Render Kanban
        async function renderKanban() {
            await loadData();
            const tasks = appData.tasks || [];
            
            const columns = {
                open: { title: 'üìã Offen', color: '#6b7280', tasks: tasks.filter(t => t.status === 'open') },
                in_progress: { title: '‚ö° In Arbeit', color: '#f59e0b', tasks: tasks.filter(t => t.status === 'in_progress') },
                done: { title: '‚úÖ Erledigt', color: '#22c55e', tasks: tasks.filter(t => t.status === 'done') }
            };
            
            document.getElementById('mainContent').innerHTML = `
                <div class="page-header">
                    <h2>üìã Kanban Board</h2>
                    <p>Verschieben Sie Aufgaben per Drag & Drop zwischen den Spalten.</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
                    ${Object.entries(columns).map(([status, column]) => `
                        <div class="card" style="min-height: 500px;">
                            <div class="card-header" style="border-bottom: 3px solid ${column.color};">
                                <div class="card-title">
                                    ${column.title}
                                    <span style="margin-left: 8px; padding: 4px 10px; background: ${column.color}20; color: ${column.color}; border-radius: 20px; font-size: 12px;">
                                        ${column.tasks.length}
                                    </span>
                                </div>
                            </div>
                            <div class="card-body" style="padding: 16px;">
                                <div style="display: flex; flex-direction: column; gap: 12px; min-height: 400px;" 
                                     ondragover="allowDrop(event)" 
                                     ondrop="drop(event, '${status}')">
                                    ${column.tasks.map(task => `
                                        <div draggable="true" 
                                             ondragstart="drag(event, ${task.id})"
                                             style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 12px; cursor: move; transition: all 0.2s;"
                                             onmouseover="this.style.borderColor='${column.color}'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';"
                                             onmouseout="this.style.borderColor='var(--border-color)'; this.style.transform=''; this.style.boxShadow='';">
                                            <div style="font-weight: 600; margin-bottom: 8px;">${task.title}</div>
                                            <div style="display: flex; align-items: center; gap: 8px; font-size: 12px;">
                                                <span style="padding: 2px 8px; background: ${getPriorityColor(task.priority)}; border-radius: 4px; color: white;">${task.priority}</span>
                                                <span style="color: var(--text-tertiary);">#${task.id}</span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Render Bot Control
        function renderBot() {
            document.getElementById('mainContent').innerHTML = `
                <div class="page-header">
                    <h2>ü§ñ Bot Control</h2>
                    <p>Steuern Sie den OpenClaw Bot und √ºberwachen Sie die Aktivit√§ten.</p>
                </div>

                <div class="content-grid">
                    <div>
                        <div class="card" style="margin-bottom: 24px;">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-terminal"></i> Bot Konsole
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="botConsole" style="background: #1f2937; color: #e5e7eb; padding: 20px; border-radius: 12px; height: 300px; overflow-y: auto; font-family: monospace; font-size: 13px; line-height: 1.6;">
                                    <!-- Console wird dynamisch gef√ºllt -->
                                </div>
                                <div style="display: flex; gap: 12px; margin-top: 16px;">
                                    <input type="text" id="botCommand" placeholder="Befehl eingeben..." 
                                           style="flex: 1; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 12px;"
                                           onkeypress="if(event.key==='Enter') executeBotCommand()">
                                    <button class="btn btn-primary" onclick="executeBotCommand()">
                                        <i class="fas fa-play"></i> Ausf√ºhren
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-bolt"></i> Schnellbefehle
                                </div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    <button class="btn btn-secondary" onclick="quickBotCommand('status')">
                                        <i class="fas fa-info-circle"></i> Status anzeigen
                                    </button>
                                    <button class="btn btn-secondary" onclick="clearBotLogs()">
                                        <i class="fas fa-trash"></i> Logs l√∂schen
                                    </button>
                                    <button class="btn btn-secondary" onclick="quickBotCommand('help')">
                                        <i class="fas fa-question-circle"></i> Hilfe
                                    </button>
                                </div>
                                <div style="margin-top: 16px; padding: 12px; background: #f0f9ff; border-radius: 8px; font-size: 13px; color: #0369a1;">
                                    <i class="fas fa-robot" style="margin-right: 8px;"></i>
                                    Der Bot arbeitet automatisch! Erstellen Sie eine Aufgabe mit Keywords (clock, weather, calculator) im Kanban Board.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="card" style="margin-bottom: 24px;">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-chart-pie"></i> Bot Status
                                </div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 16px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>Status</span>
                                        <span style="padding: 6px 12px; background: #dcfce7; color: #166534; border-radius: 20px; font-weight: 600;">
                                            <i class="fas fa-circle" style="font-size: 8px; margin-right: 6px;"></i> Online
                                        </span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>API Verbindung</span>
                                        <span style="color: #16a34a; font-weight: 600;">Verbunden</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>Letzte Aktivit√§t</span>
                                        <span>${new Date().toLocaleTimeString()}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>Generierte Apps</span>
                                        <span style="font-weight: 700; color: var(--primary-600);">24</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-history"></i> Letzte Aktionen
                                </div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    ${appData.botLogs && appData.botLogs.length > 0 ? appData.botLogs.slice(0, 5).map((log, index) => `
                                        <div style="display: flex; align-items: center; gap: 12px; font-size: 14px;">
                                            <div style="width: 8px; height: 8px; background: ${log.type === 'success' ? '#22c55e' : log.type === 'error' ? '#ef4444' : log.type === 'info' ? '#3b82f6' : '#f59e0b'}; border-radius: 50%;"></div>
                                            <span>${log.message}</span>
                                            <span style="margin-left: auto; color: var(--text-tertiary);">${log.time || index + 'm ago'}</span>
                                        </div>
                                    `).join('') : `
                                        <div style="display: flex; align-items: center; gap: 12px; font-size: 14px; color: var(--text-tertiary);">
                                            <i class="fas fa-info-circle"></i>
                                            <span>Noch keine Aktionen</span>
                                        </div>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Console mit Logs aktualisieren
            setTimeout(updateBotConsole, 100);
        }

        // Helper functions
        function getStatusColor(status) {
            const colors = {
                active: '#22c55e',
                in_progress: '#f59e0b',
                completed: '#3b82f6',
                on_hold: '#6b7280',
                open: '#6b7280',
                done: '#22c55e'
            };
            return colors[status] || '#6b7280';
        }

        function getStatusBg(status) {
            const colors = {
                active: '#dcfce7',
                in_progress: '#fef3c7',
                completed: '#dbeafe',
                on_hold: '#f3f4f6',
                open: '#f3f4f6',
                done: '#dcfce7'
            };
            return colors[status] || '#f3f4f6';
        }

        function getPriorityColor(priority) {
            const colors = {
                low: '#6b7280',
                medium: '#f59e0b',
                high: '#ef4444',
                critical: '#7f1d1d'
            };
            return colors[priority] || '#6b7280';
        }

        // Drag & Drop functions
        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev, taskId) {
            ev.dataTransfer.setData("taskId", taskId);
        }

        async function drop(ev, newStatus) {
            ev.preventDefault();
            const taskId = ev.dataTransfer.getData("taskId");
            
            // Update task status locally
            const task = appData.tasks.find(t => t.id == taskId);
            if (task) {
                const oldStatus = task.status;
                task.status = newStatus;
                
                showToast(`Aufgabe verschoben nach "${newStatus === 'open' ? 'Offen' : newStatus === 'in_progress' ? 'In Arbeit' : 'Erledigt'}"`, 'success');
                renderKanban();
                
                // üéØ AUTO-BOT TRIGGER: Wenn Status auf "in_progress" gewechselt wird
                if (newStatus === 'in_progress' && oldStatus !== 'in_progress') {
                    console.log('ü§ñ Auto-Bot: Task moved to in_progress, checking keywords...');
                    checkAndTriggerAutoBot(task);
                }
            }
        }
        
        // ü§ñ Auto-Bot: Check keywords and trigger generation
        async function checkAndTriggerAutoBot(task) {
            console.log('ü§ñ BOT: Checking task:', task.title);
            
            const keywords = {
                weather: ['weather', 'wetter', 'forecast', 'vorhersage'],
                calculator: ['calculator', 'rechner', 'calc', 'taschenrechner'],
                todo: ['todo', 'task', 'aufgabe', 'liste'],
                clock: ['clock', 'uhr', 'time', 'zeit']
            };
            
            const titleLower = task.title.toLowerCase();
            let detectedType = null;
            
            for (const [type, words] of Object.entries(keywords)) {
                if (words.some(word => titleLower.includes(word))) {
                    detectedType = type;
                    break;
                }
            }
            
            if (detectedType) {
                console.log(`ü§ñ BOT: Keyword erkannt -> ${detectedType}`);
                showToast(`ü§ñ Bot erkannt: "${detectedType}" - Generiere App...`, 'info');
                
                // Simuliere Bot-Arbeit (3 Sekunden)
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // App lokal erstellen (Frontend-Only f√ºr Demo)
                const appName = detectedType.charAt(0).toUpperCase() + detectedType.slice(1) + 'App';
                
                appData.apps.push({
                    id: Date.now(),
                    name: appName,
                    type: detectedType,
                    icon: getAppIcon(detectedType),
                    date: new Date().toLocaleDateString('de-DE'),
                    status: 'active',
                    description: `Automatisch generierte ${detectedType} App`
                });
                
                // Bot Log hinzuf√ºgen
                appData.botLogs = appData.botLogs || [];
                appData.botLogs.unshift({
                    message: `‚úÖ ${appName} erfolgreich generiert!`,
                    type: 'success',
                    time: new Date().toLocaleTimeString()
                });
                
                // üíæ Speichern in localStorage
                saveToStorage();
                
                // Console sofort aktualisieren wenn Bot Control angezeigt wird
                updateBotConsole();
                
                showToast(`‚úÖ ${appName} wurde erstellt!`, 'success');
                console.log(`ü§ñ BOT: ${appName} created successfully`);
                
                // Versuche Backend-API (optional)
                try {
                    const response = await fetch('/api/code/generate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            type: detectedType,
                            taskTitle: task.title
                        })
                    });
                    
                    if (response.ok) {
                        console.log('ü§ñ BOT: Backend generation successful');
                    }
                } catch (error) {
                    console.log('ü§ñ BOT: Backend not available, using frontend-only mode');
                }
                
            } else {
                console.log('ü§ñ BOT: Kein Keyword erkannt in:', task.title);
                showToast('ü§ñ Kein App-Keyword erkannt', 'info');
            }
        }
        
        function getAppIcon(type) {
            const icons = {
                weather: '‚òÄÔ∏è',
                calculator: 'üßÆ',
                todo: '‚úÖ',
                clock: 'üïê'
            };
            return icons[type] || 'üöÄ';
        }
        
        // ü§ñ Update Bot Console Display
        function updateBotConsole() {
            const consoleDiv = document.getElementById('botConsole');
            if (!consoleDiv) return;
            
            let html = '';
            
            // Initial logs
            html += '<div style="color: #22c55e;">> Bot initialized successfully</div>';
            html += '<div style="color: #60a5fa;">> Connected to API server</div>';
            html += '<div style="color: #9ca3af;">> Waiting for commands...</div>';
            
            // Add logs from appData
            if (appData.botLogs && appData.botLogs.length > 0) {
                appData.botLogs.forEach(log => {
                    const color = log.type === 'success' ? '#22c55e' : 
                                  log.type === 'error' ? '#ef4444' : 
                                  log.type === 'info' ? '#60a5fa' : '#e5e7eb';
                    html += `<div style="color: ${color};">> [${log.time}] ${log.message}</div>`;
                });
            }
            
            consoleDiv.innerHTML = html;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        // Action functions
        function createProject() {
            // Create modal for new project
            const modal = document.createElement('div');
            modal.id = 'projectModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.2s;
            `;
            
            modal.innerHTML = `
                <div style="background: var(--bg-secondary); border-radius: 20px; padding: 32px; width: 90%; max-width: 500px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); animation: slideUp 0.3s;">
                    <h3 style="font-size: 24px; font-weight: 700; margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
                        <i class="fas fa-folder-plus" style="color: #3b82f6;"></i>
                        Neues Projekt erstellen
                    </h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Projektname *</label>
                        <input type="text" id="projectName" placeholder="z.B. OpenClaw Dashboard" 
                               style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 12px; font-size: 14px;"
                               onfocus="this.style.borderColor='#3b82f6'" onblur="this.style.borderColor='var(--border-color)'">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Beschreibung</label>
                        <textarea id="projectDesc" rows="3" placeholder="Kurze Beschreibung des Projekts..."
                                  style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 12px; font-size: 14px; resize: vertical;"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Status</label>
                        <select id="projectStatus" style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 12px; font-size: 14px;">
                            <option value="active">üü¢ Aktiv</option>
                            <option value="in_progress">üü° In Planung</option>
                            <option value="on_hold">‚ö™ Pausiert</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button class="btn btn-secondary" onclick="closeProjectModal()">
                            <i class="fas fa-times"></i> Abbrechen
                        </button>
                        <button class="btn btn-primary" onclick="saveProject()">
                            <i class="fas fa-save"></i> Projekt erstellen
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
            `;
            document.head.appendChild(style);
            
            // Focus on input
            setTimeout(() => document.getElementById('projectName').focus(), 100);
        }
        
        function closeProjectModal() {
            const modal = document.getElementById('projectModal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => modal.remove(), 200);
            }
        }
        
        function saveProject() {
            const name = document.getElementById('projectName').value.trim();
            const desc = document.getElementById('projectDesc').value.trim();
            const status = document.getElementById('projectStatus').value;
            
            if (!name) {
                showToast('Bitte geben Sie einen Projektnamen ein', 'error');
                return;
            }
            
            // Create new project
            const newProject = {
                id: Date.now(),
                title: name,
                description: desc || 'Keine Beschreibung',
                status: status,
                created_at: new Date().toISOString()
            };
            
            appData.projects.push(newProject);
            
            // AUTO-CREATE: Create initial task for the project
            const initialTask = {
                id: Date.now() + 1,
                title: `${name} - Projekt starten`,
                project_id: newProject.id,
                priority: 'high',
                status: 'open'
            };
            appData.tasks.push(initialTask);
            
            // üíæ Speichern in localStorage
            saveToStorage();
            
            closeProjectModal();
            
            // Refresh projects view
            if (document.querySelector('.page-header h2')?.textContent.includes('Projekte')) {
                renderProjects();
            }
            
            showToast(`Projekt "${name}" erstellt + Erste Aufgabe hinzugef√ºgt!`, 'success');
        }

        function editProject(id) {
            showToast(`Projekt ${id} bearbeiten - Coming Soon!`, 'info');
        }

        function deleteProject(id) {
            if (confirm('Projekt wirklich l√∂schen?')) {
                appData.projects = appData.projects.filter(p => p.id !== id);
                renderProjects();
                showToast('Projekt gel√∂scht', 'success');
            }
        }

        function createTask() {
            showToast('Neue Aufgabe erstellen - Coming Soon!', 'info');
        }

        function toggleTaskStatus(id, checked) {
            const task = appData.tasks.find(t => t.id === id);
            if (task) {
                task.status = checked ? 'done' : 'open';
                renderTasks();
                showToast(checked ? 'Aufgabe erledigt! ‚úÖ' : 'Aufgabe wieder ge√∂ffnet', 'success');
            }
        }

        function deleteTask(id) {
            if (confirm('Aufgabe wirklich l√∂schen?')) {
                appData.tasks = appData.tasks.filter(t => t.id !== id);
                renderTasks();
                showToast('Aufgabe gel√∂scht', 'success');
            }
        }

        function filterTasks(status) {
            showToast(`Filter: ${status} - Coming Soon!`, 'info');
        }

        function executeBotCommand() {
            const input = document.getElementById('botCommand');
            const command = input.value.trim();
            if (!command) return;
            
            const consoleDiv = document.getElementById('botConsole');
            consoleDiv.innerHTML += `<div style="color: #e5e7eb; margin-top: 8px;">> ${command}</div>`;
            
            // Simulate bot response
            setTimeout(() => {
                let response = 'Befehl nicht erkannt. Nutzen Sie "help" f√ºr Hilfe.';
                if (command === 'help') {
                    response = 'Verf√ºgbare Befehle: status, generate <app>, help';
                } else if (command === 'status') {
                    response = 'Bot Status: Online | API: Verbunden | Letzte Aktivit√§t: Jetzt';
                } else if (command.startsWith('generate')) {
                    response = `Generiere ${command.replace('generate ', '')}... ‚úÖ Erfolgreich!`;
                }
                
                consoleDiv.innerHTML += `<div style="color: #22c55e; margin-top: 4px;">> ${response}</div>`;
                consoleDiv.scrollTop = consoleDiv.scrollHeight;
            }, 500);
            
            input.value = '';
        }

        function quickBotCommand(cmd) {
            document.getElementById('botCommand').value = cmd;
            executeBotCommand();
        }

        function clearBotLogs() {
            if (confirm('Alle Bot-Logs l√∂schen?')) {
                appData.botLogs = [];
                saveToStorage();
                updateBotConsole();
                showToast('üóëÔ∏è Logs gel√∂scht', 'success');
            }
        }

        // Render Apps
        function renderApps() {
            // Verwende tats√§chliche Daten aus appData.apps
            const apps = appData.apps.length > 0 ? appData.apps : [
                { name: 'WeatherApp', type: 'Wetter', icon: '‚òÄÔ∏è', date: '13.02.2026', status: 'active' },
                { name: 'Calculator', type: 'Rechner', icon: 'üßÆ', date: '12.02.2026', status: 'active' },
                { name: 'TodoApp', type: 'Aufgaben', icon: '‚úÖ', date: '10.02.2026', status: 'active' },
            ];
            
            document.getElementById('mainContent').innerHTML = `
                <div class="page-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2>üöÄ Meine Apps</h2>
                            <p>Verwalten Sie Ihre generierten Anwendungen.</p>
                        </div>
                        <button class="btn btn-primary" onclick="showToast('Neue App erstellen - Coming Soon!', 'info')">
                            <i class="fas fa-plus"></i> App erstellen
                        </button>
                    </div>
                </div>

                <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 24px;">
                    <div class="stat-card blue">
                        <div class="stat-value">${appData.apps.length}</div>
                        <div class="stat-label">Generierte Apps</div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-value">${appData.apps.filter(a => a.status === 'active').length}</div>
                        <div class="stat-label">Aktive</div>
                    </div>
                    <div class="stat-card purple">
                        <div class="stat-value">${appData.apps.filter(a => a.status === 'archived').length}</div>
                        <div class="stat-label">Archiviert</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-rocket"></i> Alle Apps
                        </div>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px;">
                            ${apps.map(app => `
                                <div style="background: var(--bg-tertiary); border-radius: 16px; padding: 24px; border: 2px solid var(--border-color); transition: all 0.2s; cursor: pointer;"
                                     onmouseover="this.style.borderColor='#3b82f6'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 10px 15px -3px rgba(0,0,0,0.1)';"
                                     onmouseout="this.style.borderColor='var(--border-color)'; this.style.transform=''; this.style.boxShadow='';">
                                    <div style="display: flex; align-items: flex-start; gap: 16px; margin-bottom: 16px;">
                                        <div style="font-size: 48px;">${app.icon}</div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: 700; font-size: 18px; margin-bottom: 4px;">${app.name}</div>
                                            <div style="color: var(--text-secondary); font-size: 14px;">${app.type}</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                        <span style="padding: 6px 12px; background: #dcfce7; color: #166534; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                            <i class="fas fa-circle" style="font-size: 6px; margin-right: 4px;"></i> ${app.status === 'active' ? 'Aktiv' : 'Inaktiv'}
                                        </span>
                                        <span style="font-size: 12px; color: var(--text-tertiary);">${app.date}</span>
                                    </div>
                                     <div style="display: flex; gap: 8px;">
                                         <button class="btn btn-primary btn-sm" style="flex: 1;" onclick="startApp('${app.type}')">
                                             <i class="fas fa-play"></i> Starten
                                         </button>
                                         <button class="btn btn-secondary btn-sm" onclick="downloadApp('${app.type}', '${app.name}')">
                                             <i class="fas fa-download"></i>
                                         </button>
                                         <button class="btn btn-sm" style="background: #24292e; color: white;" onclick="pushToGitHub('${app.name}', '${app.type}')" title="Zu GitHub pushen">
                                             <i class="fab fa-github"></i>
                                         </button>
                                     </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // üöÄ App starten (in neuem Tab)
        function startApp(appType) {
            const appContent = generateAppHTML(appType);
            const blob = new Blob([appContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');
            showToast(`üöÄ ${appType} App wird gestartet...`, 'success');
        }

        // üíæ App downloaden
        function downloadApp(appType, appName) {
            showToast(`üì¶ ${appName} wird erstellt...`, 'info');

            setTimeout(() => {
                const appContent = generateAppHTML(appType);
                const blob = new Blob([appContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = `${appName}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                URL.revokeObjectURL(url);
                showToast(`‚úÖ ${appName}.html wurde heruntergeladen!`, 'success');
            }, 1000);
        }
        
        // üì¶ App zu GitHub pushen
        async function pushToGitHub(appName, appType) {
            const githubToken = getApiKey('github');
            
            if (!githubToken) {
                showToast('Bitte zuerst GitHub Token in Einstellungen speichern!', 'error');
                showSection('settings');
                return;
            }
            
            showToast('üóÇÔ∏è GitHub Repository ausw√§hlen...', 'info');
            
            // Repository Auswahl Modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; width: 90%; max-width: 500px; padding: 24px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
                    <h3 style="margin: 0 0 16px 0;"><i class="fab fa-github"></i> Zu GitHub pushen</h3>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Repository</label>
                        <select id="githubRepoSelect" style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 8px;">
                            <option value="">Laden...</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Ordner (optional)</label>
                        <input type="text" id="githubFolder" placeholder="z.B. apps/${appName.toLowerCase()}" 
                            style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 8px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Branch</label>
                        <input type="text" id="githubBranch" value="main" 
                            style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 8px;">
                    </div>
                    
                    <div style="display: flex; gap: 8px; justify-content: flex-end;">
                        <button onclick="this.closest('[style*=\\"position: fixed\\"]').remove()" class="btn btn-secondary">
                            Abbrechen
                        </button>
                        <button onclick="executeGitHubPush('${appName}')" class="btn btn-primary">
                            <i class="fas fa-upload"></i> Pushen
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Repositories laden
            try {
                const response = await fetch(`${API_URL}/github/repos`, {
                    headers: { 'X-GitHub-Token': githubToken }
                });
                const result = await response.json();
                
                const select = document.getElementById('githubRepoSelect');
                if (result.success && result.repos.length > 0) {
                    select.innerHTML = result.repos.map(repo => 
                        `<option value="${repo.full_name}">${repo.full_name} ${repo.private ? 'üîí' : ''}</option>`
                    ).join('');
                } else {
                    select.innerHTML = '<option value="">Keine Repositories gefunden</option>';
                }
            } catch (error) {
                console.error('Fehler beim Laden der Repositories:', error);
            }
        }
        
        // GitHub Push ausf√ºhren
        async function executeGitHubPush(appName) {
            const githubToken = getApiKey('github');
            const repoSelect = document.getElementById('githubRepoSelect');
            const folderInput = document.getElementById('githubFolder');
            const branchInput = document.getElementById('githubBranch');
            
            const repoFullName = repoSelect.value;
            if (!repoFullName) {
                showToast('Bitte Repository ausw√§hlen!', 'warning');
                return;
            }
            
            const [owner, repo] = repoFullName.split('/');
            const folder = folderInput.value || appName.toLowerCase();
            const branch = branchInput.value || 'main';
            
            // Modal schlie√üen
            document.querySelector('[style*="position: fixed"]').remove();
            
            showToast('‚è≥ Pushe zu GitHub...', 'info');
            
            try {
                const response = await fetch(`${API_URL}/github/push-folder`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-GitHub-Token': githubToken
                    },
                    body: JSON.stringify({
                        owner,
                        repo,
                        folderPath: folder,
                        branch,
                        appName
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(`‚úÖ ${result.message}!`, 'success');
                } else {
                    showToast(`‚ùå Fehler: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('GitHub Push Fehler:', error);
                showToast('Verbindungsfehler!', 'error');
            }
        }

        // üé® HTML-Code f√ºr Apps generieren
        function generateAppHTML(appType) {
            const templates = {
                clock: `<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Digital Clock</title>
    <style>body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;display:flex;align-items:center;justify-content:center;margin:0}.container{background:white;padding:40px 60px;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);text-align:center}.time{font-size:72px;font-weight:700;color:#333}.date{font-size:24px;color:#666;margin-top:10px}</style>
</head>
<body>
    <div class="container">
        <div class="time" id="time">00:00:00</div>
        <div class="date" id="date">Datum</div>
    </div>
    <\/script>
<\/body>
<\/html>`,

                weather: `<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>WeatherApp</title>
    <style>body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#74b9ff,#0984e3);min-height:100vh;display:flex;align-items:center;justify-content:center;margin:0}.card{background:white;padding:40px;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);text-align:center;width:300px}.city{font-size:28px;font-weight:700;color:#333}.temp{font-size:64px;color:#0984e3;margin:20px 0}.icon{font-size:80px}</style>
</head>
<body>
    <div class="card">
        <div class="city">Berlin</div>
        <div class="icon">‚òÄÔ∏è</div>
        <div class="temp">22¬∞C</div>
        <div style="color:#666">Sonnig</div>
    </div>
<\/body>
<\/html>`,

                calculator: `<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Calculator</title>
    <style>body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#a8edea,#fed6e3);min-height:100vh;display:flex;align-items:center;justify-content:center;margin:0}.calc{background:#333;padding:20px;border-radius:20px;width:300px}.display{background:#444;color:white;font-size:36px;padding:20px;text-align:right;border-radius:10px;margin-bottom:20px;min-height:40px}.buttons{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}button{padding:20px;font-size:20px;border:none;border-radius:10px;cursor:pointer;background:#666;color:white}button:hover{background:#777}button.op{background:#ff9500}button.eq{background:#28a745;grid-column:span 2}button.cl{background:#dc3545}</style>
</head>
<body>
    <div class="calc">
        <div class="display" id="d">0</div>
        <div class="buttons">
            <button class="cl" onclick="c()">C</button><button class="op" onclick="a('/')">√∑</button><button class="op" onclick="a('*')">√ó</button><button onclick="a('-')" class="op">-</button>
            <button onclick="a('7')">7</button><button onclick="a('8')">8</button><button onclick="a('9')">9</button><button onclick="a('+')" class="op">+</button>
            <button onclick="a('4')">4</button><button onclick="a('5')">5</button><button onclick="a('6')">6</button><button onclick="a('.')">.</button>
            <button onclick="a('1')">1</button><button onclick="a('2')">2</button><button onclick="a('3')">3</button><button onclick="a('0')">0</button>
            <button class="eq" onclick="e()">=</button>
        </div>
    </div>
    <script>let d=document.getElementById('d');function a(v){d.textContent==='0'?d.textContent=v:d.textContent+=v}function c(){d.textContent='0'}function e(){try{d.textContent=eval(d.textContent)}catch{d.textContent='Error'}}<\/script>
<\/body>
<\/html>`,

                todo: `<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>TodoApp</title>
    <style>body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#fa709a,#fee140);min-height:100vh;display:flex;align-items:center;justify-content:center;margin:0}.container{background:white;padding:30px;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);width:90%;max-width:500px}h1{text-align:center;color:#333}.input{display:flex;gap:10px;margin-bottom:20px}input{flex:1;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:16px}button.add{padding:12px 24px;background:#28a745;color:white;border:none;border-radius:8px;cursor:pointer;font-size:16px}ul{list-style:none;padding:0}li{display:flex;align-items:center;padding:12px;background:#f8f9fa;margin-bottom:8px;border-radius:8px}li.done{text-decoration:line-through;opacity:0.6}input.cb{margin-right:12px;width:20px;height:20px}button.del{margin-left:auto;background:#dc3545;color:white;border:none;padding:6px 12px;border-radius:4px;cursor:pointer}</style>
</head>
<body>
    <div class="container">
        <h1>‚úÖ Meine Aufgaben</h1>
        <div class="input"><input type="text" id="in" placeholder="Neue Aufgabe..."><button class="add" onclick="add()">+</button></div>
        <ul id="list"></ul>
    </div>
    <\/script>
<\/body>
<\/html>`
            };
            return templates[appType] || templates.clock;
        }

        // Render Agents
        function renderAgents() {
            const allModels = AI_MODEL_REGISTRY.getAllActive();
            const agents = Object.entries(AGENT_TEMPLATES).map(([key, template]) => ({
                key,
                ...template,
                status: 'online',
                tasks: Math.floor(Math.random() * 30),
                color: getAgentColor(key)
            }));
            
            document.getElementById('mainContent').innerHTML = `
                <div class="page-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2>ü§ñ Agenten & Modelle</h2>
                            <p>6 Agenten mit festen Rollen. Modelle √§nderbar (au√üer Code-Architect üîí Kimi). ${allModels.length} Modelle verf√ºgbar.</p>
                        </div>
                        <button class="btn btn-primary" onclick="showModelRegistry()">
                            <i class="fas fa-database"></i> Model Registry
                        </button>
                    </div>
                </div>

                <!-- Model Tier Overview -->
                <div class="stats-grid" style="grid-template-columns: repeat(5, 1fr); margin-bottom: 24px;">
                    <div class="stat-card" style="border-left: 4px solid #22c55e;">
                        <div class="stat-value" style="font-size: 24px;">${AI_MODEL_REGISTRY.free.length}</div>
                        <div class="stat-label">üÜì Kostenlos</div>
                    </div>
                    <div class="stat-card" style="border-left: 4px solid #3b82f6;">
                        <div class="stat-value" style="font-size: 24px;">${AI_MODEL_REGISTRY.budget.length}</div>
                        <div class="stat-label">üí∞ Budget</div>
                    </div>
                    <div class="stat-card" style="border-left: 4px solid #8b5cf6;">
                        <div class="stat-value" style="font-size: 24px;">${AI_MODEL_REGISTRY.premium.length}</div>
                        <div class="stat-label">‚≠ê Premium</div>
                    </div>
                    <div class="stat-card" style="border-left: 4px solid #f59e0b;">
                        <div class="stat-value" style="font-size: 24px;">${AI_MODEL_REGISTRY.ultra.length}</div>
                        <div class="stat-label">üíé Ultra</div>
                    </div>
                    <div class="stat-card" style="border-left: 4px solid #10b981;">
                        <div class="stat-value" style="font-size: 24px;">${agents.length}</div>
                        <div class="stat-label">ü§ñ Agenten</div>
                    </div>
                </div>

                <!-- Active Agents -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-robot"></i> Konfigurierte Agenten
                        </div>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 20px;">
                            ${agents.map(agent => {
                                const currentModel = allModels.find(m => m.id === agent.defaultModel) || allModels[0];
                                return `
                                <div style="background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 16px; padding: 20px; transition: all 0.2s;"
                                     onmouseover="this.style.borderColor='${agent.color}'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';"
                                     onmouseout="this.style.borderColor='var(--border-color)'; this.style.boxShadow='';">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="width: 48px; height: 48px; background: ${agent.color}20; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: ${agent.color}; font-size: 24px;">
                                                <i class="fas fa-robot"></i>
                                            </div>
                                            <div>
                                                <div style="font-weight: 700; font-size: 16px;">${agent.name}</div>
                                                <div style="font-size: 12px; color: var(--text-tertiary);">${agent.role}</div>
                                            </div>
                                        </div>
                                        <span style="padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; background: #dcfce7; color: #166534;">
                                            üü¢ Online
                                        </span>
                                    </div>
                                    
                                    <div style="margin-bottom: 16px; padding: 12px; background: var(--bg-tertiary); border-radius: 8px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <span style="font-size: 13px; color: var(--text-secondary);">Aktives Modell:</span>
                                            <span style="font-size: 13px; font-weight: 600; color: ${getTierColor(currentModel.tier)};">${currentModel.name}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 12px;">
                                            <span style="color: var(--text-tertiary);">Kosten:</span>
                                            <span style="color: ${currentModel.cost.output === 0 ? '#22c55e' : '#f59e0b'};">
                                                ${currentModel.cost.output === 0 ? 'üÜì Kostenlos' : `$${currentModel.cost.output}/1K tokens`}
                                            </span>
                                        </div>
                                    </div>

                                    <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px;">
                                        ${agent.capabilities.slice(0, 3).map(cap => `
                                            <span style="padding: 4px 10px; background: ${agent.color}15; color: ${agent.color}; border-radius: 12px; font-size: 11px;">${cap}</span>
                                        `).join('')}
                                    </div>
                                    
                                    <div style="display: flex; gap: 8px;">
                                        ${agent.locked ? `
                                            <button class="btn btn-sm" style="flex: 1; background: #dcfce7; color: #166534; border: 1px solid #86efac; cursor: not-allowed;" disabled title="${agent.lockedReason}">
                                                <i class="fas fa-lock"></i> üîí Fest: Kimi
                                            </button>
                                        ` : `
                                            <button class="btn btn-secondary btn-sm" style="flex: 1;" onclick="configureAgent('${agent.key}')">
                                                <i class="fas fa-sliders-h"></i> Modell √§ndern
                                            </button>
                                        `}
                                        <button class="btn btn-primary btn-sm" onclick="showToast('${agent.name} wird aktiviert...', 'success')">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    </div>
                                </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>

                <!-- Quick Model Selector -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-bolt"></i> Schnellauswahl
                        </div>
                    </div>
                    <div class="card-body">
                        <p style="color: var(--text-secondary); margin-bottom: 16px;">W√§hlen Sie ein Modell basierend auf Ihren Anforderungen:</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 12px;">
                            ${allModels.slice(0, 6).map(model => `
                                <div style="padding: 16px; border: 2px solid var(--border-color); border-radius: 12px; cursor: pointer; transition: all 0.2s;"
                                     onmouseover="this.style.borderColor='${getTierColor(model.tier)}'; this.style.transform='translateY(-2px)';"
                                     onmouseout="this.style.borderColor='var(--border-color)'; this.style.transform='';"
                                     onclick="selectModelForAgent('${model.id}')">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <span style="font-weight: 600; font-size: 14px;">${model.name}</span>
                                        <span style="padding: 4px 8px; background: ${getTierColor(model.tier)}20; color: ${getTierColor(model.tier)}; border-radius: 12px; font-size: 10px; font-weight: 600; text-transform: uppercase;">${model.tier}</span>
                                    </div>
                                    <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: 8px;">${model.provider}</div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; font-size: 12px;">
                                        <span>üìù ${(model.specs.contextWindow / 1000).toFixed(0)}K Context</span>
                                        <span style="color: ${model.cost.output === 0 ? '#22c55e' : 'var(--text-secondary)'};">${model.cost.output === 0 ? 'üÜì Free' : `$${model.cost.output}`}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function getAgentColor(key) {
            const colors = {
                'code-architect': '#3b82f6',
                'doc-writer': '#8b5cf6',
                'planner': '#f59e0b',
                'debugger': '#22c55e',
                'tester': '#6b7280',
                'reviewer': '#ec4899'
            };
            return colors[key] || '#3b82f6';
        }

        function getTierColor(tier) {
            const colors = {
                'free': '#22c55e',
                'budget': '#3b82f6',
                'premium': '#8b5cf6',
                'ultra': '#f59e0b'
            };
            return colors[tier] || '#6b7280';
        }

        function showModelRegistry() {
            const allModels = AI_MODEL_REGISTRY.getAllActive();
            const tiers = ['free', 'budget', 'premium', 'ultra'];
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: var(--bg-secondary); border-radius: 20px; padding: 32px; width: 100%; max-width: 900px; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="font-size: 24px; font-weight: 700;">
                            <i class="fas fa-database" style="color: #3b82f6; margin-right: 12px;"></i>
                            AI Model Registry v${AI_MODEL_REGISTRY.version}
                        </h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-tertiary);">&times;</button>
                    </div>
                    
                    <p style="color: var(--text-secondary); margin-bottom: 24px;">
                        ${allModels.length} Modelle verf√ºgbar | Letztes Update: ${AI_MODEL_REGISTRY.lastUpdated}
                    </p>
                    
                    ${tiers.map(tier => {
                        const models = AI_MODEL_REGISTRY[tier].filter(m => m.status === 'active');
                        if (models.length === 0) return '';
                        return `
                            <div style="margin-bottom: 24px;">
                                <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 12px; color: ${getTierColor(tier)}; text-transform: uppercase;">
                                    ${tier === 'free' ? 'üÜì Kostenlos' : tier === 'budget' ? 'üí∞ Budget' : tier === 'premium' ? '‚≠ê Premium' : 'üíé Ultra'}
                                </h3>
                                <div style="display: grid; gap: 12px;">
                                    ${models.map(model => `
                                        <div style="padding: 16px; border: 1px solid var(--border-color); border-radius: 12px; background: var(--bg-tertiary);">
                                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                                                <div>
                                                    <div style="font-weight: 600; font-size: 16px;">${model.name}</div>
                                                    <div style="font-size: 13px; color: var(--text-tertiary);">${model.provider}</div>
                                                </div>
                                                <span style="padding: 4px 12px; background: ${getTierColor(tier)}20; color: ${getTierColor(tier)}; border-radius: 12px; font-size: 11px; font-weight: 600;">${tier}</span>
                                            </div>
                                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">${model.description}</div>
                                            <div style="display: flex; flex-wrap: wrap; gap: 12px; font-size: 12px;">
                                                <span>üìù ${(model.specs.contextWindow / 1000).toFixed(0)}K Context</span>
                                                <span>üî§ ${model.specs.maxTokens.toLocaleString()} Tokens</span>
                                                <span style="color: ${model.cost.output === 0 ? '#22c55e' : '#f59e0b'};">
                                                    ${model.cost.output === 0 ? 'üÜì Kostenlos' : `üí∞ $${model.cost.input}/$${model.cost.output} per 1K`}
                                                </span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
        }

        function configureAgent(agentKey) {
            const agent = AGENT_TEMPLATES[agentKey];
            if (agent.locked) {
                showToast(`üîí ${agent.name} ist fest auf ${agent.defaultModel} konfiguriert`, 'info');
                return;
            }
            
            // Modellauswahl Modal anzeigen
            const allModels = AI_MODEL_REGISTRY.getAllActive();
            const currentModel = allModels.find(m => m.id === agent.defaultModel);
            
            // Modal Container erstellen
            const modal = document.createElement('div');
            modal.id = 'modelSelectionModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(4px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 16px;
                    width: 90%;
                    max-width: 700px;
                    max-height: 80vh;
                    overflow: hidden;
                    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
                ">
                    <div style="
                        background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
                        padding: 24px;
                        color: white;
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="margin: 0; font-size: 20px; font-weight: 700;">
                                    <i class="fas fa-robot"></i> ${agent.name}
                                </h3>
                                <p style="margin: 4px 0 0 0; opacity: 0.9; font-size: 14px;">${agent.role} - Modell ausw√§hlen</p>
                            </div>
                            <button onclick="closeModelModal()" style="
                                background: rgba(255,255,255,0.2);
                                border: none;
                                color: white;
                                width: 36px;
                                height: 36px;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 18px;
                            "><i class="fas fa-times"></i></button>
                        </div>
                    </div>
                    
                    <div style="padding: 24px; max-height: 60vh; overflow-y: auto;">
                        <div style="margin-bottom: 20px; padding: 12px; background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-weight: 600; color: #166534;"><i class="fas fa-check-circle"></i> Aktuelles Modell:</span>
                                <span style="font-weight: 700; color: #15803d;">${currentModel ? currentModel.name : agent.defaultModel}</span>
                            </div>
                        </div>
                        
                        <p style="margin-bottom: 16px; color: #64748b; font-size: 14px;">
                            W√§hlen Sie ein neues Modell f√ºr diesen Agenten:
                        </p>
                        
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            ${allModels.map(model => {
                                const isCurrent = model.id === agent.defaultModel;
                                const isRecommended = agent.fallbackModels.includes(model.id);
                                return `
                                <div onclick="selectModelForAgent('${agentKey}', '${model.id}')" style="
                                    padding: 16px;
                                    border: 2px solid ${isCurrent ? '#22c55e' : isRecommended ? '#3b82f6' : '#e2e8f0'};
                                    border-radius: 12px;
                                    cursor: pointer;
                                    transition: all 0.2s;
                                    background: ${isCurrent ? '#f0fdf4' : 'white'};
                                    position: relative;
                                " onmouseover="this.style.borderColor='${isCurrent ? '#22c55e' : '#8b5cf6'}'; this.style.transform='translateX(4px)';" 
                                   onmouseout="this.style.borderColor='${isCurrent ? '#22c55e' : isRecommended ? '#3b82f6' : '#e2e8f0'}'; this.style.transform='';">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <span style="font-weight: 700; font-size: 15px;">${model.name}</span>
                                            ${isCurrent ? '<span style="padding: 3px 8px; background: #22c55e; color: white; border-radius: 12px; font-size: 10px; font-weight: 600;">AKTUELL</span>' : ''}
                                            ${isRecommended && !isCurrent ? '<span style="padding: 3px 8px; background: #3b82f6; color: white; border-radius: 12px; font-size: 10px; font-weight: 600;">EMPFOHLEN</span>' : ''}
                                        </div>
                                        <span style="padding: 4px 10px; background: ${getTierColor(model.tier)}20; color: ${getTierColor(model.tier)}; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase;">${model.tier}</span>
                                    </div>
                                    <div style="font-size: 13px; color: #64748b; margin-bottom: 8px;">${model.provider} ‚Ä¢ ${model.specs.description}</div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; font-size: 12px;">
                                        <span>üìù ${(model.specs.contextWindow / 1000).toFixed(0)}K Context</span>
                                        <span style="color: ${model.cost.output === 0 ? '#22c55e' : '#f59e0b'}; font-weight: 600;">
                                            ${model.cost.output === 0 ? 'üÜì Kostenlos' : `$${model.cost.output}/1K tokens`}
                                        </span>
                                    </div>
                                </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div style="padding: 20px 24px; border-top: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 13px; color: #64748b;">${allModels.length} Modelle verf√ºgbar</span>
                        <button onclick="closeModelModal()" style="
                            padding: 10px 24px;
                            background: #f1f5f9;
                            border: none;
                            border-radius: 8px;
                            color: #64748b;
                            font-weight: 600;
                            cursor: pointer;
                        ">Schlie√üen</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function closeModelModal() {
            const modal = document.getElementById('modelSelectionModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function selectModelForAgent(agentKey, modelId) {
            const agent = AGENT_TEMPLATES[agentKey];
            const allModels = AI_MODEL_REGISTRY.getAllActive();
            const model = allModels.find(m => m.id === modelId);
            
            if (!model) return;
            
            // Modell aktualisieren
            agent.defaultModel = modelId;
            
            // Speichern in localStorage
            try {
                const savedAgents = JSON.parse(localStorage.getItem('agentConfigs') || '{}');
                savedAgents[agentKey] = { defaultModel: modelId };
                localStorage.setItem('agentConfigs', JSON.stringify(savedAgents));
            } catch (e) {
                console.error('Fehler beim Speichern:', e);
            }
            
            // Modal schlie√üen und Toast anzeigen
            closeModelModal();
            showToast(`‚úÖ ${agent.name} verwendet jetzt ${model.name}!`, 'success');
            
            // Seite neu rendern
            setTimeout(() => renderAgents(), 300);
        }

        // Render Settings
        function renderSettings() {
            const currentTheme = getCurrentTheme();
            const apiKeys = getAllApiKeys();
            const currentUser = getCurrentUser();
            const isAdmin = currentUser && currentUser.role === 'admin';
            
            document.getElementById('mainContent').innerHTML = `
                <div class="page-header">
                    <h2>‚öôÔ∏è Einstellungen</h2>
                    <p>Konfigurieren Sie Ihr Dashboard und API-Verbindungen.</p>
                </div>

                <div class="content-grid" style="grid-template-columns: 1fr 1fr;">
                    <div>
                        ${isAdmin ? `
                        <div class="card" style="margin-bottom: 24px;">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-users"></i> Benutzerverwaltung
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="userManagement">
                                    <div style="text-align: center; padding: 20px;">
                                        <i class="fas fa-spinner fa-spin"></i> Lade Benutzer...
                                    </div>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        <div class="card" style="margin-bottom: 24px;">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-key"></i> API Keys
                                </div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 16px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Kimi AI (Kostenlos)</label>
                                        <div style="display: flex; gap: 8px;">
                                            <input type="password" id="apiKey-kimi" value="${apiKeys.kimi || ''}" placeholder="API Key eingeben"
                                                style="flex: 1; padding: 10px 14px; border: 2px solid var(--border-color); border-radius: 10px; font-family: monospace; font-size: 13px; background: var(--bg-tertiary);">
                                            <button class="btn btn-secondary btn-sm" onclick="copyApiKey('kimi')" title="Kopieren">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                            <button class="btn btn-primary btn-sm" onclick="toggleApiKeyVisibility('kimi')" title="Anzeigen/Verbergen">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                                            <button class="btn btn-primary btn-sm" style="flex: 1;" onclick="saveApiKeySetting('kimi')">
                                                <i class="fas fa-save"></i> Speichern
                                            </button>
                                            <button class="btn btn-sm" style="background: #fee2e2; color: #dc2626;" onclick="deleteApiKeySetting('kimi')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">OpenAI</label>
                                        <div style="display: flex; gap: 8px;">
                                            <input type="password" id="apiKey-openai" value="${apiKeys.openai || ''}" placeholder="sk-..."
                                                style="flex: 1; padding: 10px 14px; border: 2px solid var(--border-color); border-radius: 10px; font-family: monospace; font-size: 13px; background: var(--bg-tertiary);">
                                            <button class="btn btn-secondary btn-sm" onclick="copyApiKey('openai')" title="Kopieren">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                            <button class="btn btn-primary btn-sm" onclick="toggleApiKeyVisibility('openai')" title="Anzeigen/Verbergen">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                                            <button class="btn btn-primary btn-sm" style="flex: 1;" onclick="saveApiKeySetting('openai')">
                                                <i class="fas fa-save"></i> Speichern
                                            </button>
                                            <button class="btn btn-sm" style="background: #fee2e2; color: #dc2626;" onclick="deleteApiKeySetting('openai')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Anthropic Claude</label>
                                        <div style="display: flex; gap: 8px;">
                                            <input type="password" id="apiKey-anthropic" value="${apiKeys.anthropic || ''}" placeholder="sk-ant-..."
                                                style="flex: 1; padding: 10px 14px; border: 2px solid var(--border-color); border-radius: 10px; font-family: monospace; font-size: 13px; background: var(--bg-tertiary);">
                                            <button class="btn btn-secondary btn-sm" onclick="copyApiKey('anthropic')" title="Kopieren">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                            <button class="btn btn-primary btn-sm" onclick="toggleApiKeyVisibility('anthropic')" title="Anzeigen/Verbergen">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                                            <button class="btn btn-primary btn-sm" style="flex: 1;" onclick="saveApiKeySetting('anthropic')">
                                                <i class="fas fa-save"></i> Speichern
                                            </button>
                                            <button class="btn btn-sm" style="background: #fee2e2; color: #dc2626;" onclick="deleteApiKeySetting('anthropic')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card" style="margin-bottom: 24px;">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fab fa-github"></i> GitHub Integration
                                </div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 16px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Personal Access Token</label>
                                        <div style="display: flex; gap: 8px;">
                                            <input type="password" id="apiKey-github" value="${apiKeys.github || ''}" placeholder="ghp_xxxxxxxxxxxx"
                                                style="flex: 1; padding: 10px 14px; border: 2px solid var(--border-color); border-radius: 10px; font-family: monospace; font-size: 13px; background: var(--bg-tertiary);">
                                            <button class="btn btn-secondary btn-sm" onclick="copyApiKey('github')" title="Kopieren">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                            <button class="btn btn-primary btn-sm" onclick="toggleApiKeyVisibility('github')" title="Anzeigen/Verbergen">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                                            <button class="btn btn-primary btn-sm" style="flex: 1;" onclick="saveApiKeySetting('github')">
                                                <i class="fas fa-save"></i> Speichern
                                            </button>
                                            <button class="btn btn-sm" style="background: #fee2e2; color: #dc2626;" onclick="deleteApiKeySetting('github')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        <p style="font-size: 11px; color: var(--text-tertiary); margin-top: 8px;">
                                            <a href="https://github.com/settings/tokens/new?scopes=repo" target="_blank" style="color: var(--primary-500);">
                                                <i class="fas fa-external-link-alt"></i> Token erstellen
                                            </a> (ben√∂tigt "repo" Berechtigung)
                                        </p>
                                    </div>
                                    <div id="githubStatus" style="padding: 12px; background: var(--bg-tertiary); border-radius: 8px; display: none;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <i class="fab fa-github"></i>
                                            <span id="githubUser">Nicht verbunden</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card" style="margin-bottom: 24px;">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-bell"></i> Webhooks
                                </div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 16px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">
                                            <i class="fab fa-slack"></i> Slack Webhook URL
                                        </label>
                                        <div style="display: flex; gap: 8px;">
                                            <input type="password" id="webhook-slack" value="${localStorage.getItem('webhook_slack') || ''}" placeholder="https://hooks.slack.com/services/..."
                                                style="flex: 1; padding: 10px 14px; border: 2px solid var(--border-color); border-radius: 10px; font-family: monospace; font-size: 13px; background: var(--bg-tertiary);">
                                            <button class="btn btn-primary btn-sm" onclick="toggleApiKeyVisibility('webhook-slack')" title="Anzeigen/Verbergen">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <button class="btn btn-secondary btn-sm" style="margin-top: 8px;" onclick="testWebhook('slack')">
                                            <i class="fas fa-paper-plane"></i> Testen
                                        </button>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">
                                            <i class="fab fa-discord"></i> Discord Webhook URL
                                        </label>
                                        <div style="display: flex; gap: 8px;">
                                            <input type="password" id="webhook-discord" value="${localStorage.getItem('webhook_discord') || ''}" placeholder="https://discord.com/api/webhooks/..."
                                                style="flex: 1; padding: 10px 14px; border: 2px solid var(--border-color); border-radius: 10px; font-family: monospace; font-size: 13px; background: var(--bg-tertiary);">
                                            <button class="btn btn-primary btn-sm" onclick="toggleApiKeyVisibility('webhook-discord')" title="Anzeigen/Verbergen">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <button class="btn btn-secondary btn-sm" style="margin-top: 8px;" onclick="testWebhook('discord')">
                                            <i class="fas fa-paper-plane"></i> Testen
                                        </button>
                                    </div>
                                    <div id="webhookStatus" style="padding: 12px; background: var(--bg-tertiary); border-radius: 8px; display: none;">
                                        <div style="font-size: 13px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-database"></i> Daten & Backup
                                </div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    <button class="btn btn-secondary" onclick="exportData()">
                                        <i class="fas fa-download"></i> Daten exportieren
                                    </button>
                                    <button class="btn btn-secondary" onclick="createBackup()">
                                        <i class="fas fa-archive"></i> Backup erstellen
                                    </button>
                                    <button class="btn" style="background: #fee2e2; color: #dc2626;" onclick="resetAllData()">
                                        <i class="fas fa-trash"></i> Daten zur√ºcksetzen
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="card" style="margin-bottom: 24px;">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-palette"></i> Erscheinungsbild
                                </div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 16px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Theme</label>
                                        <select id="themeSelect" style="width: 100%; padding: 10px 14px; border: 2px solid var(--border-color); border-radius: 10px; font-size: 14px; background: var(--bg-tertiary); color: var(--text-primary);" onchange="changeTheme(this.value)">
                                            <option value="light" ${currentTheme === 'light' ? 'selected' : ''}>‚òÄÔ∏è Hell</option>
                                            <option value="dark" ${currentTheme === 'dark' ? 'selected' : ''}>üåô Dunkel</option>
                                            <option value="auto" ${currentTheme === 'auto' ? 'selected' : ''}>üîÑ System</option>
                                        </select>
                                    </div>
                                    <div style="padding: 12px; background: var(--bg-tertiary); border-radius: 8px; margin-top: 8px;">
                                        <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--text-secondary);">
                                            <i class="fas fa-info-circle"></i>
                                            Aktuell: ${currentTheme === 'light' ? '‚òÄÔ∏è Hell' : currentTheme === 'dark' ? 'üåô Dunkel' : 'üîÑ System'}
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Sprache</label>
                                        <select style="width: 100%; padding: 10px 14px; border: 2px solid var(--border-color); border-radius: 10px; font-size: 14px; background: var(--bg-tertiary); color: var(--text-primary);" onchange="showToast('Sprache ge√§ndert', 'success')">
                                            <option value="de">üá©üá™ Deutsch</option>
                                            <option value="en">üá¨üáß English</option>
                                        </select>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <input type="checkbox" id="animations" checked style="width: 18px; height: 18px;">
                                        <label for="animations" style="font-size: 14px;">Animationen aktivieren</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-info-circle"></i> System-Info
                                </div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 12px; font-size: 14px;">
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: var(--text-secondary);">Version</span>
                                        <span style="font-weight: 600;">v2.0.0 Pro</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: var(--text-secondary);">Letztes Update</span>
                                        <span style="font-weight: 600;">13.02.2026</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: var(--text-secondary);">Datenbank</span>
                                        <span id="dbStatus" style="font-weight: 600; color: #22c55e;">‚úì Verbunden</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: var(--text-secondary);">API Status</span>
                                        <span id="apiStatus" style="font-weight: 600; color: #22c55e;">‚úì Online</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Load user management if admin
            const currentUser = getCurrentUser();
            if (currentUser && currentUser.role === 'admin') {
                loadUserManagement();
            }
            
            // System-Status aktualisieren
            updateSystemStatus();
        }
        
        // Theme wechseln
        function changeTheme(theme) {
            setTheme(theme);
            showToast(`Theme ge√§ndert zu: ${theme === 'light' ? '‚òÄÔ∏è Hell' : theme === 'dark' ? 'üåô Dunkel' : 'üîÑ System'}`, 'success');
        }
        
        // API Key visibility toggle
        function toggleApiKeyVisibility(provider) {
            const input = document.getElementById(`apiKey-${provider}`);
            if (input.type === 'password') {
                input.type = 'text';
            } else {
                input.type = 'password';
            }
        }
        
        // API Key kopieren
        function copyApiKey(provider) {
            const input = document.getElementById(`apiKey-${provider}`);
            if (input.value) {
                navigator.clipboard.writeText(input.value).then(() => {
                    showToast('API Key kopiert!', 'success');
                });
            } else {
                showToast('Kein API Key vorhanden', 'warning');
            }
        }
        
        // API Key speichern
        function saveApiKeySetting(provider) {
            const input = document.getElementById(`apiKey-${provider}`);
            const key = input.value.trim();
            
            if (!key) {
                showToast('Bitte API Key eingeben', 'warning');
                return;
            }
            
            if (saveApiKey(provider, key)) {
                showToast(`${provider.toUpperCase()} API Key gespeichert!`, 'success');
            } else {
                showToast('Fehler beim Speichern', 'error');
            }
        }
        
        // API Key l√∂schen
        function deleteApiKeySetting(provider) {
            if (confirm(`M√∂chten Sie den ${provider.toUpperCase()} API Key wirklich l√∂schen?`)) {
                if (deleteApiKey(provider)) {
                    document.getElementById(`apiKey-${provider}`).value = '';
                    showToast('API Key gel√∂scht', 'success');
                }
            }
        }

        // Webhook testen
        async function testWebhook(platform) {
            const input = document.getElementById(`webhook-${platform}`);
            const webhookUrl = input.value.trim();
            const statusDiv = document.getElementById('webhookStatus');
            
            if (!webhookUrl) {
                showToast('Bitte Webhook URL eingeben', 'warning');
                return;
            }

            // Save to localStorage
            localStorage.setItem(`webhook_${platform}`, webhookUrl);
            
            statusDiv.style.display = 'block';
            statusDiv.querySelector('div').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sende Test-Nachricht...';
            
            try {
                const response = await fetch('/api/webhooks/send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        platform: platform,
                        message: '‚úÖ Test-Nachricht von OpenClaw Dashboard',
                        data: { webhookUrl: webhookUrl }
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.querySelector('div').innerHTML = `<i class="fas fa-check-circle" style="color: #22c55e;"></i> ${platform.charAt(0).toUpperCase() + platform.slice(1)}: Nachricht erfolgreich gesendet!`;
                    showToast(`${platform} Webhook funktioniert!`, 'success');
                } else {
                    statusDiv.querySelector('div').innerHTML = `<i class="fas fa-times-circle" style="color: #dc2626;"></i> ${platform.charAt(0).toUpperCase() + platform.slice(1)}: ${result.error || 'Fehler'}`;
                    showToast(result.error || 'Fehler beim Senden', 'error');
                }
            } catch (err) {
                statusDiv.querySelector('div').innerHTML = `<i class="fas fa-times-circle" style="color: #dc2626;"></i> ${platform.charAt(0).toUpperCase() + platform.slice(1)}: ${err.message}`;
                showToast('Verbindungsfehler', 'error');
            }
        }
        
        // Daten exportieren
        function exportData() {
            const data = {
                projects: appData.projects,
                tasks: appData.tasks,
                apps: appData.apps,
                exportDate: new Date().toISOString(),
                version: '2.0.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `openclaw-export-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Daten exportiert!', 'success');
        }
        
        // Backup erstellen
        function createBackup() {
            const backup = {
                appData: appData,
                agentConfigs: JSON.parse(localStorage.getItem('agentConfigs') || '{}'),
                apiKeys: JSON.parse(localStorage.getItem(API_KEYS_KEY) || '{}'),
                theme: localStorage.getItem(THEME_KEY),
                backupDate: new Date().toISOString(),
                version: '2.0.0'
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `openclaw-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Backup erstellt!', 'success');
        }
        
        // Alle Daten zur√ºcksetzen
        function resetAllData() {
            if (confirm('‚ö†Ô∏è WARNUNG: Dies l√∂scht ALLE Daten unwiderruflich!\n\nM√∂chten Sie wirklich fortfahren?')) {
                if (confirm('Letzte Sicherheitsabfrage: Alle Projekte, Tasks und Einstellungen werden gel√∂scht.\n\nSind Sie sicher?')) {
                    localStorage.removeItem('openclawData');
                    localStorage.removeItem('agentConfigs');
                    localStorage.removeItem(API_KEYS_KEY);
                    localStorage.removeItem(THEME_KEY);
                    
                    appData = { projects: [], tasks: [], apps: [], botLogs: [] };
                    
                    showToast('Alle Daten zur√ºckgesetzt. Seite wird neu geladen...', 'success');
                    setTimeout(() => location.reload(), 2000);
                }
            }
        }
        
        // System-Status aktualisieren
        async function updateSystemStatus() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                
                const apiStatus = document.getElementById('apiStatus');
                if (data.status === 'healthy') {
                    apiStatus.innerHTML = '‚úì Online';
                    apiStatus.style.color = '#22c55e';
                } else {
                    apiStatus.innerHTML = '‚úó Offline';
                    apiStatus.style.color = '#dc2626';
                }
            } catch (error) {
                const apiStatus = document.getElementById('apiStatus');
                apiStatus.innerHTML = '‚úó Fehler';
                apiStatus.style.color = '#dc2626';
            }
        }

        // Render Analytics
        async function renderAnalytics() {
            const currentUser = getCurrentUser();
            const isAdmin = currentUser && currentUser.role === 'admin';
            
            document.getElementById('mainContent').innerHTML = `
                <div class="page-header">
                    <h2>üìä Analytics & Kosten√ºbersicht</h2>
                    <p>API-Nutzung und gesch√§tzte Kosten.</p>
                </div>

                <div style="margin-bottom: 24px; display: flex; gap: 12px;">
                    <button class="btn btn-sm" onclick="loadAnalytics('24h')">24h</button>
                    <button class="btn btn-sm" onclick="loadAnalytics('7d')">7 Tage</button>
                    <button class="btn btn-sm" onclick="loadAnalytics('30d')">30 Tage</button>
                    <button class="btn btn-sm" onclick="loadAnalytics('all')">Alle</button>
                    ${isAdmin ? '<button class="btn btn-sm" style="background: #fee2e2; color: #dc2626; margin-left: auto;" onclick="resetAnalytics()"><i class="fas fa-trash"></i> Zur√ºcksetzen</button>' : ''}
                </div>

                <div id="analyticsContent">
                    <div style="text-align: center; padding: 60px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 32px;"></i>
                        <p style="margin-top: 16px;">Lade Analytics...</p>
                    </div>
                </div>
            `;
            
            loadAnalytics('7d');
        }

        async function loadAnalytics(period = '7d') {
            const container = document.getElementById('analyticsContent');
            if (!container) return;
            
            try {
                const response = await fetch(`${API_URL}/analytics/stats?period=${period}`, {
                    headers: { 'Authorization': `Bearer ${getAuthToken()}` }
                });
                
                if (!response.ok) throw new Error('Keine Berechtigung');
                
                const data = await response.json();
                
                if (!data.success) throw new Error(data.error);
                
                const cost = data.costEstimate;
                const totalCalls = data.summary.totalCalls;
                const avgDuration = Math.round(data.summary.avgDuration);
                
                container.innerHTML = `
                    <div class="content-grid" style="grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div class="card" style="text-align: center;">
                            <div style="font-size: 32px; font-weight: 700; color: var(--primary-500);">${totalCalls.toLocaleString()}</div>
                            <div style="color: var(--text-secondary);">API Aufrufe</div>
                        </div>
                        <div class="card" style="text-align: center;">
                            <div style="font-size: 32px; font-weight: 700; color: #22c55e;">$${cost.total.toFixed(4)}</div>
                            <div style="color: var(--text-secondary);">Gesch√§tzte Kosten</div>
                        </div>
                        <div class="card" style="text-align: center;">
                            <div style="font-size: 32px; font-weight: 700; color: #3b82f6;">${avgDuration}ms</div>
                            <div style="color: var(--text-secondary);">Durchschn. Dauer</div>
                        </div>
                        <div class="card" style="text-align: center;">
                            <div style="font-size: 32px; font-weight: 700; color: #f59e0b;">${data.byEndpoint.length}</div>
                            <div style="color: var(--text-secondary);">Endpunkte</div>
                        </div>
                    </div>

                    <div class="content-grid" style="grid-template-columns: 1fr 1fr; gap: 24px;">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title"><i class="fas fa-chart-bar"></i> Aufrufe nach Endpunkt</div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    ${data.byEndpoint.map(e => `
                                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: var(--bg-tertiary); border-radius: 6px;">
                                            <code style="font-size: 12px;">${e.endpoint}</code>
                                            <span style="font-weight: 600;">${e.count}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div class="card-title"><i class="fas fa-dollar-sign"></i> Kostenaufteilung</div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    ${Object.entries(cost.breakdown).map(([provider, c]) => `
                                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: var(--bg-tertiary); border-radius: 6px;">
                                            <span>${provider}</span>
                                            <span style="font-weight: 600; color: #22c55e;">$${c.toFixed(4)}</span>
                                        </div>
                                    `).join('')}
                                    ${Object.keys(cost.breakdown).length === 0 ? '<div style="color: var(--text-tertiary);">Keine Kosten erfasst</div>' : ''}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-history"></i> Letzte Aufrufe</div>
                        </div>
                        <div class="card-body" style="padding: 0;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="border-bottom: 1px solid var(--border-color);">
                                        <th style="padding: 12px; text-align: left; font-size: 12px; color: var(--text-secondary);">Zeit</th>
                                        <th style="padding: 12px; text-align: left; font-size: 12px; color: var(--text-secondary);">Endpunkt</th>
                                        <th style="padding: 12px; text-align: left; font-size: 12px; color: var(--text-secondary);">Dauer</th>
                                        <th style="padding: 12px; text-align: left; font-size: 12px; color: var(--text-secondary);">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.recentCalls.map(c => `
                                        <tr style="border-bottom: 1px solid var(--border-color);">
                                            <td style="padding: 12px; font-size: 12px;">${new Date(c.created_at).toLocaleString()}</td>
                                            <td style="padding: 12px;"><code style="font-size: 11px;">${c.endpoint}</code></td>
                                            <td style="padding: 12px; font-size: 12px;">${c.duration_ms}ms</td>
                                            <td style="padding: 12px;"><span style="padding: 2px 8px; border-radius: 4px; font-size: 11px; background: ${c.status_code < 400 ? '#dcfce7' : '#fee2e2'}; color: ${c.status_code < 400 ? '#16a34a' : '#dc2626'};">${c.status_code}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } catch (err) {
                container.innerHTML = `<div style="text-align: center; padding: 40px; color: var(--text-error);">Fehler: ${err.message}</div>`;
            }
        }

        async function resetAnalytics() {
            if (!confirm('M√∂chten Sie alle Analytics-Daten zur√ºcksetzen?')) return;
            
            try {
                const response = await fetch(`${API_URL}/analytics/reset`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${getAuthToken()}` }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast('Analytics zur√ºckgesetzt', 'success');
                    loadAnalytics('7d');
                } else {
                    showToast(data.error || 'Fehler', 'error');
                }
            } catch (err) {
                showToast('Fehler: ' + err.message, 'error');
            }
        }

        // Render Context/Documents
        async function renderContext() {
            document.getElementById('mainContent').innerHTML = `
                <div class="page-header">
                    <h2>üìö Context & Dokumentation</h2>
                    <p>Technische Dokumentation, Coding Patterns und Projekt-Informationen.</p>
                </div>

                <div class="content-grid" style="grid-template-columns: 300px 1fr; gap: 24px;">
                    <!-- Sidebar mit Datei-Liste -->
                    <div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-folder-open"></i> Dateien
                                </div>
                            </div>
                            <div class="card-body" style="padding: 0;">
                                <div id="contextFileList" style="display: flex; flex-direction: column;">
                                    <div style="padding: 16px; text-align: center; color: var(--text-tertiary);">
                                        <i class="fas fa-spinner fa-spin"></i> Laden...
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card" style="margin-top: 20px;">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-info-circle"></i> Info
                                </div>
                            </div>
                            <div class="card-body">
                                <p style="font-size: 13px; color: var(--text-secondary); line-height: 1.5;">
                                    Diese Dokumente enthalten wichtige Informationen √ºber Coding Patterns, Projekt-Status und Agenten-Konfiguration.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Hauptbereich mit Markdown-Inhalt -->
                    <div>
                        <div class="card">
                            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                                <div class="card-title" id="contextTitle">
                                    <i class="fas fa-file-alt"></i> Dokumentation
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button class="btn btn-secondary btn-sm" onclick="refreshContext()" title="Aktualisieren">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                    <button class="btn btn-secondary btn-sm" onclick="copyContextContent()" title="Kopieren">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                    <button class="btn btn-primary btn-sm" id="editContextBtn" onclick="toggleContextEdit()" title="Bearbeiten" style="display: none;">
                                        <i class="fas fa-edit"></i> Bearbeiten
                                    </button>
                                    <button class="btn btn-success btn-sm" id="saveContextBtn" onclick="saveContextContent()" title="Speichern" style="display: none;">
                                        <i class="fas fa-save"></i> Speichern
                                    </button>
                                    <button class="btn btn-secondary btn-sm" id="cancelEditBtn" onclick="cancelContextEdit()" title="Abbrechen" style="display: none;">
                                        <i class="fas fa-times"></i> Abbrechen
                                    </button>
                                </div>
                            </div>
                            <div class="card-body" id="contextContent" style="padding: 24px; max-height: 70vh; overflow-y: auto;">
                                <div style="text-align: center; padding: 40px; color: var(--text-tertiary);">
                                    <i class="fas fa-hand-pointer" style="font-size: 48px; margin-bottom: 16px;"></i>
                                    <p>W√§hlen Sie eine Datei aus der Liste aus</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Dateien laden
            await loadContextFiles();
        }
        
        // Context-Dateien laden
        async function loadContextFiles() {
            try {
                const response = await fetch(`${API_URL}/context-docs/files`);
                const result = await response.json();
                
                if (result.success) {
                    const fileList = document.getElementById('contextFileList');
                    fileList.innerHTML = result.files.map(file => `
                        <div onclick="loadContextFile('${file.name}', '${file.title}')" style="
                            padding: 16px;
                            cursor: pointer;
                            border-bottom: 1px solid var(--border-color);
                            transition: all 0.2s;
                            ${file.name === currentContextFile ? 'background: var(--primary-500); color: white;' : ''}
                        " onmouseover="this.style.background='${file.name === currentContextFile ? 'var(--primary-500)' : 'var(--bg-tertiary)'}'" 
                           onmouseout="this.style.background='${file.name === currentContextFile ? 'var(--primary-500)' : 'transparent'}'"
                           class="context-file-item" data-filename="${file.name}">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 4px;">
                                <i class="fas fa-file-code" style="color: ${file.name === currentContextFile ? 'white' : 'var(--primary-500)'};"></i>
                                <span style="font-weight: 600;">${file.title}</span>
                            </div>
                            <div style="font-size: 12px; color: ${file.name === currentContextFile ? 'rgba(255,255,255,0.8)' : 'var(--text-tertiary)'}; margin-left: 28px;">
                                ${file.description}
                            </div>
                            <div style="font-size: 11px; color: ${file.name === currentContextFile ? 'rgba(255,255,255,0.6)' : 'var(--text-tertiary)'}; margin-left: 28px; margin-top: 4px;">
                                ${file.size} ‚Ä¢ ${file.lastModified}
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Fehler beim Laden der Context-Dateien:', error);
                document.getElementById('contextFileList').innerHTML = `
                    <div style="padding: 16px; color: var(--error-500);">
                        <i class="fas fa-exclamation-triangle"></i> Fehler beim Laden
                    </div>
                `;
            }
        }
        
        // Aktuelle Datei speichern
        let currentContextFile = null;
        let currentContextContent = '';
        
        // Einzelne Datei laden
        async function loadContextFile(filename, title) {
            try {
                currentContextFile = filename;
                document.getElementById('contextTitle').innerHTML = `<i class="fas fa-file-alt"></i> ${title}`;
                document.getElementById('contextContent').innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fas fa-spinner fa-spin"></i> Laden...</div>';
                
                // UI aktualisieren
                document.querySelectorAll('.context-file-item').forEach(item => {
                    if (item.dataset.filename === filename) {
                        item.style.background = 'var(--primary-500)';
                        item.style.color = 'white';
                    } else {
                        item.style.background = 'transparent';
                        item.style.color = 'var(--text-primary)';
                    }
                });
                
                const response = await fetch(`${API_URL}/context-docs/file/${filename}`);
                const result = await response.json();
                
                if (result.success) {
                    currentContextContent = result.content;
                    document.getElementById('contextContent').innerHTML = renderMarkdown(result.content);
                    
                    // Bearbeiten-Button anzeigen
                    document.getElementById('editContextBtn').style.display = 'inline-flex';
                    document.getElementById('saveContextBtn').style.display = 'none';
                    document.getElementById('cancelEditBtn').style.display = 'none';
                } else {
                    document.getElementById('contextContent').innerHTML = `
                        <div style="color: var(--error-500); padding: 20px;">
                            <i class="fas fa-exclamation-circle"></i> Fehler: ${result.error}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Fehler beim Laden der Datei:', error);
                document.getElementById('contextContent').innerHTML = `
                    <div style="color: var(--error-500); padding: 20px;">
                        <i class="fas fa-exclamation-circle"></i> Fehler beim Laden der Datei
                    </div>
                `;
            }
        }
        
        // Einfacher Markdown-Renderer
        function renderMarkdown(content) {
            // Escape HTML
            let html = content
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
            
            // Headers
            html = html.replace(/^### (.*$)/gim, '<h3 style="color: var(--primary-600); margin-top: 24px; margin-bottom: 12px; font-size: 20px;">$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2 style="color: var(--primary-600); margin-top: 28px; margin-bottom: 16px; font-size: 24px; border-bottom: 2px solid var(--border-color); padding-bottom: 8px;">$1</h2>');
            html = html.replace(/^# (.*$)/gim, '<h1 style="color: var(--primary-600); margin-top: 32px; margin-bottom: 20px; font-size: 28px;">$1</h1>');
            
            // Code blocks
            html = html.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                return `<pre style="background: #1e293b; color: #e2e8f0; padding: 16px; border-radius: 8px; overflow-x: auto; margin: 16px 0; font-family: monospace; font-size: 14px;"><code>${code.trim()}</code></pre>`;
            });
            
            // Inline code
            html = html.replace(/`([^`]+)`/g, '<code style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px; font-family: monospace; font-size: 14px; color: var(--primary-600);">$1</code>');
            
            // Bold
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong style="font-weight: 700;">$1</strong>');
            
            // Italic
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Links
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color: var(--primary-600); text-decoration: none;">$1</a>');
            
            // Bullet lists
            html = html.replace(/^\- (.*$)/gim, '<li style="margin-left: 20px; margin-bottom: 4px;">$1</li>');
            html = html.replace(/(<li.*<\/li>\n?)+/g, '<ul style="margin: 12px 0; list-style-type: disc;">$&</ul>');
            
            // Numbered lists
            html = html.replace(/^\d+\. (.*$)/gim, '<li style="margin-left: 20px; margin-bottom: 4px;">$1</li>');
            
            // Line breaks
            html = html.replace(/\n/g, '<br>');
            
            // Horizontal rules
            html = html.replace(/^---$/gim, '<hr style="border: none; border-top: 2px solid var(--border-color); margin: 24px 0;">');
            
            return `<div style="line-height: 1.8; font-size: 15px; color: var(--text-primary);">${html}</div>`;
        }
        
        // Context aktualisieren
        async function refreshContext() {
            await loadContextFiles();
            if (currentContextFile) {
                await loadContextFile(currentContextFile, document.getElementById('contextTitle').textContent.trim());
            }
            showToast('Context aktualisiert', 'success');
        }
        
        // Content kopieren
        function copyContextContent() {
            if (currentContextContent) {
                navigator.clipboard.writeText(currentContextContent).then(() => {
                    showToast('Inhalt kopiert!', 'success');
                });
            } else {
                showToast('Kein Inhalt zum Kopieren', 'warning');
            }
        }
        
        // Bearbeiten-Modus umschalten
        let isEditingContext = false;
        
        function toggleContextEdit() {
            if (!currentContextFile) {
                showToast('Bitte zuerst eine Datei ausw√§hlen', 'warning');
                return;
            }
            
            isEditingContext = !isEditingContext;
            
            const editBtn = document.getElementById('editContextBtn');
            const saveBtn = document.getElementById('saveContextBtn');
            const cancelBtn = document.getElementById('cancelEditBtn');
            const contentDiv = document.getElementById('contextContent');
            
            if (isEditingContext) {
                // Bearbeiten-Modus
                editBtn.style.display = 'none';
                saveBtn.style.display = 'inline-flex';
                cancelBtn.style.display = 'inline-flex';
                
                // Textarea anzeigen
                contentDiv.innerHTML = `
                    <textarea id="contextEditor" style="
                        width: 100%;
                        min-height: 60vh;
                        padding: 16px;
                        border: 2px solid var(--primary-500);
                        border-radius: 8px;
                        font-family: monospace;
                        font-size: 14px;
                        line-height: 1.6;
                        background: var(--bg-tertiary);
                        color: var(--text-primary);
                        resize: vertical;
                    ">${currentContextContent}</textarea>
                    <div style="margin-top: 12px; font-size: 13px; color: var(--text-secondary);">
                        <i class="fas fa-info-circle"></i> √Ñnderungen werden nach dem Speichern in die Datei geschrieben.
                    </div>
                `;
            } else {
                // Abbrechen - zur√ºck zur Ansicht
                cancelContextEdit();
            }
        }
        
        // Bearbeiten abbrechen
        function cancelContextEdit() {
            isEditingContext = false;
            
            const editBtn = document.getElementById('editContextBtn');
            const saveBtn = document.getElementById('saveContextBtn');
            const cancelBtn = document.getElementById('cancelEditBtn');
            const contentDiv = document.getElementById('contextContent');
            
            editBtn.style.display = 'inline-flex';
            saveBtn.style.display = 'none';
            cancelBtn.style.display = 'none';
            
            // Zur√ºck zur Markdown-Ansicht
            contentDiv.innerHTML = renderMarkdown(currentContextContent);
        }
        
        // Inhalt speichern
        async function saveContextContent() {
            const editor = document.getElementById('contextEditor');
            if (!editor || !currentContextFile) {
                showToast('Fehler beim Speichern', 'error');
                return;
            }
            
            const newContent = editor.value;
            
            try {
                showToast('Speichern...', 'info');
                
                const response = await fetch(`${API_URL}/context-docs/file/${currentContextFile}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content: newContent
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentContextContent = newContent;
                    isEditingContext = false;
                    
                    // Buttons zur√ºcksetzen
                    document.getElementById('editContextBtn').style.display = 'inline-flex';
                    document.getElementById('saveContextBtn').style.display = 'none';
                    document.getElementById('cancelEditBtn').style.display = 'none';
                    
                    // Markdown anzeigen
                    document.getElementById('contextContent').innerHTML = renderMarkdown(newContent);
                    
                    showToast('‚úÖ √Ñnderungen gespeichert!', 'success');
                } else {
                    showToast('Fehler: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Fehler beim Speichern:', error);
                showToast('Verbindungsfehler', 'error');
            }
        }

        // Render Coming Soon
        function renderComingSoon(section) {
            const titles = {
                projects: 'Projekte',
                tasks: 'Aufgaben',
                kanban: 'Kanban Board',
                apps: 'Meine Apps',
                bot: 'Bot Control',
                agents: 'Agenten',
                settings: 'Einstellungen'
            };

            document.getElementById('mainContent').innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; text-align: center;">
                    <div style="font-size: 80px; margin-bottom: 24px;">üöß</div>
                    <h2 style="font-size: 32px; font-weight: 800; margin-bottom: 16px;">${titles[section] || section}</h2>
                    <p style="font-size: 18px; color: var(--text-secondary); max-width: 500px;">
                        Dieser Bereich wird mit dem neuen Design aktualisiert.
                    </p>
                    <button class="btn btn-primary" style="margin-top: 32px;" onclick="document.querySelector('[onclick=\"showSection('overview')\"]').click()">
                        <i class="fas fa-arrow-left"></i>
                        Zur√ºck zur √úbersicht
                    </button>
                </div>
            `;
        }

        // Quick action helpers for Overview
        function createProjectQuick() {
            // First navigate to projects
            showSection('projects', document.querySelector('[onclick*="projects"]'));
            // Then open modal after a short delay
            setTimeout(() => {
                createProject();
            }, 300);
        }
        
        function createTaskQuick() {
            // First navigate to tasks  
            showSection('tasks', document.querySelector('[onclick*="tasks"]'));
            // Then open modal after a short delay
            setTimeout(() => {
                createTask();
            }, 300);
        }
    </script>
</body>
</html>